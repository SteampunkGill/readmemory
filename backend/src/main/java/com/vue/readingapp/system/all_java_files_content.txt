--- 开始文件: SystemCheckForUpdates.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemCheckForUpdates {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到检查更新请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("=====================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class UpdateCheckRequest {
        private String currentVersion;
        private String platform;

        public String getCurrentVersion() { return currentVersion != null ? currentVersion : "1.0.0"; }
        public void setCurrentVersion(String currentVersion) { this.currentVersion = currentVersion; }

        public String getPlatform() { return platform != null ? platform : "web"; }
        public void setPlatform(String platform) { this.platform = platform; }
    }

    // 响应DTO
    public static class UpdateCheckResponse {
        private boolean success;
        private String message;
        private UpdateData data;

        public UpdateCheckResponse(boolean success, String message, UpdateData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public UpdateData getData() { return data; }
        public void setData(UpdateData data) { this.data = data; }
    }

    public static class UpdateData {
        private String currentVersion;
        private String latestVersion;
        private boolean updateAvailable;
        private String updateType;
        private List<ReleaseNote> releaseNotes;
        private String downloadUrl;
        private String changelogUrl;
        private boolean criticalUpdate;
        private long estimatedDownloadSize;

        public UpdateData(String currentVersion, String latestVersion, boolean updateAvailable,
                          String updateType, List<ReleaseNote> releaseNotes, String downloadUrl,
                          String changelogUrl, boolean criticalUpdate, long estimatedDownloadSize) {
            this.currentVersion = currentVersion;
            this.latestVersion = latestVersion;
            this.updateAvailable = updateAvailable;
            this.updateType = updateType;
            this.releaseNotes = releaseNotes;
            this.downloadUrl = downloadUrl;
            this.changelogUrl = changelogUrl;
            this.criticalUpdate = criticalUpdate;
            this.estimatedDownloadSize = estimatedDownloadSize;
        }

        public String getCurrentVersion() { return currentVersion; }
        public void setCurrentVersion(String currentVersion) { this.currentVersion = currentVersion; }

        public String getLatestVersion() { return latestVersion; }
        public void setLatestVersion(String latestVersion) { this.latestVersion = latestVersion; }

        public boolean isUpdateAvailable() { return updateAvailable; }
        public void setUpdateAvailable(boolean updateAvailable) { this.updateAvailable = updateAvailable; }

        public String getUpdateType() { return updateType; }
        public void setUpdateType(String updateType) { this.updateType = updateType; }

        public List<ReleaseNote> getReleaseNotes() { return releaseNotes; }
        public void setReleaseNotes(List<ReleaseNote> releaseNotes) { this.releaseNotes = releaseNotes; }

        public String getDownloadUrl() { return downloadUrl; }
        public void setDownloadUrl(String downloadUrl) { this.downloadUrl = downloadUrl; }

        public String getChangelogUrl() { return changelogUrl; }
        public void setChangelogUrl(String changelogUrl) { this.changelogUrl = changelogUrl; }

        public boolean isCriticalUpdate() { return criticalUpdate; }
        public void setCriticalUpdate(boolean criticalUpdate) { this.criticalUpdate = criticalUpdate; }

        public long getEstimatedDownloadSize() { return estimatedDownloadSize; }
        public void setEstimatedDownloadSize(long estimatedDownloadSize) { this.estimatedDownloadSize = estimatedDownloadSize; }
    }

    public static class ReleaseNote {
        private String version;
        private List<String> changes;

        public ReleaseNote(String version, List<String> changes) {
            this.version = version;
            this.changes = changes;
        }

        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }

        public List<String> getChanges() { return changes; }
        public void setChanges(List<String> changes) { this.changes = changes; }
    }

    @GetMapping("/check-update")
    public ResponseEntity<UpdateCheckResponse> checkForUpdates(@RequestParam(required = false) String currentVersion,
                                                               @RequestParam(required = false) String platform) {

        // 创建请求对象
        UpdateCheckRequest request = new UpdateCheckRequest();
        request.setCurrentVersion(currentVersion);
        request.setPlatform(platform);

        // 打印接收到的请求
        printRequest(request);

        try {
            // 1. 查询最新的版本信息
            String sql = "SELECT version_number, release_date, release_notes, is_forced_update FROM app_versions ORDER BY release_date DESC LIMIT 5";

            List<Map<String, Object>> versions = jdbcTemplate.queryForList(sql);
            printQueryResult("查询到 " + versions.size() + " 个版本记录");

            if (versions.isEmpty()) {
                // 如果没有版本信息，返回无更新
                UpdateData noUpdateData = new UpdateData(
                        request.getCurrentVersion(),
                        request.getCurrentVersion(),
                        false,
                        "none",
                        new ArrayList<>(),
                        "/download",
                        "/changelog",
                        false,
                        0
                );

                UpdateCheckResponse response = new UpdateCheckResponse(true, "当前已是最新版本", noUpdateData);
                printResponse(response);
                return ResponseEntity.ok(response);
            }

            // 2. 获取最新版本
            Map<String, Object> latestVersion = versions.get(0);
            String latestVersionNumber = (String) latestVersion.get("version_number");

            // 3. 比较版本
            boolean updateAvailable = isUpdateAvailable(request.getCurrentVersion(), latestVersionNumber);
            String updateType = determineUpdateType(request.getCurrentVersion(), latestVersionNumber);

            // 4. 构建发布说明
            List<ReleaseNote> releaseNotes = new ArrayList<>();
            for (Map<String, Object> version : versions) {
                String versionNum = (String) version.get("version_number");
                String notes = (String) version.get("release_notes");

                List<String> changes = new ArrayList<>();
                if (notes != null && !notes.trim().isEmpty()) {
                    // 简单解析发布说明
                    String[] lines = notes.split("\n");
                    for (String line : lines) {
                        line = line.trim();
                        if (!line.isEmpty()) {
                            // 移除类型标记
                            if (line.startsWith("[") && line.contains("]")) {
                                int endIndex = line.indexOf("]");
                                line = line.substring(endIndex + 1).trim();
                            }
                            changes.add(line);
                        }
                    }
                }

                // 如果没有解析到内容，添加默认项
                if (changes.isEmpty()) {
                    changes.add("版本 " + versionNum + " 更新");
                }

                releaseNotes.add(new ReleaseNote(versionNum, changes));
            }

            // 5. 判断是否为关键更新
            boolean criticalUpdate = false;
            if (latestVersion.get("is_forced_update") != null) {
                criticalUpdate = (Boolean) latestVersion.get("is_forced_update");
            }

            // 6. 估算下载大小（模拟）
            long estimatedSize = 2500000; // 2.5MB

            // 7. 构建响应数据
            UpdateData updateData = new UpdateData(
                    request.getCurrentVersion(),
                    latestVersionNumber,
                    updateAvailable,
                    updateType,
                    releaseNotes,
                    "/download/" + latestVersionNumber,
                    "/changelog/" + latestVersionNumber,
                    criticalUpdate,
                    estimatedSize
            );

            UpdateCheckResponse response = new UpdateCheckResponse(true, "检查更新完成", updateData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("检查更新过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new UpdateCheckResponse(false, "检查更新失败: " + e.getMessage(), null)
            );
        }
    }

    // 判断是否有更新
    private boolean isUpdateAvailable(String currentVersion, String latestVersion) {
        if (currentVersion == null || latestVersion == null) {
            return false;
        }

        // 简单版本比较（仅比较数字部分）
        String[] currentParts = currentVersion.split("\\.");
        String[] latestParts = latestVersion.split("\\.");

        for (int i = 0; i < Math.min(currentParts.length, latestParts.length); i++) {
            try {
                int currentPart = Integer.parseInt(currentParts[i]);
                int latestPart = Integer.parseInt(latestParts[i]);

                if (latestPart > currentPart) {
                    return true;
                } else if (latestPart < currentPart) {
                    return false;
                }
            } catch (NumberFormatException e) {
                // 如果解析失败，比较字符串
                if (!currentParts[i].equals(latestParts[i])) {
                    return true;
                }
            }
        }

        // 如果前面的部分都相等，但最新版本有更多部分，则有更新
        return latestParts.length > currentParts.length;
    }

    // 确定更新类型
    private String determineUpdateType(String currentVersion, String latestVersion) {
        if (!isUpdateAvailable(currentVersion, latestVersion)) {
            return "none";
        }

        String[] currentParts = currentVersion.split("\\.");
        String[] latestParts = latestVersion.split("\\.");

        if (currentParts.length >= 1 && latestParts.length >= 1) {
            try {
                int currentMajor = Integer.parseInt(currentParts[0]);
                int latestMajor = Integer.parseInt(latestParts[0]);

                if (latestMajor > currentMajor) {
                    return "major";
                }
            } catch (NumberFormatException e) {
                // 忽略解析错误
            }
        }

        if (currentParts.length >= 2 && latestParts.length >= 2) {
            try {
                int currentMinor = Integer.parseInt(currentParts[1]);
                int latestMinor = Integer.parseInt(latestParts[1]);

                if (latestMinor > currentMinor) {
                    return "minor";
                }
            } catch (NumberFormatException e) {
                // 忽略解析错误
            }
        }

        return "patch";
    }
}

--- 结束文件: SystemCheckForUpdates.java ---

--- 开始文件: SystemClearCache.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemClearCache {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到清理系统缓存请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("=========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class ClearCacheRequest {
        private List<String> types;
        private boolean force;

        public List<String> getTypes() {
            if (types == null || types.isEmpty()) {
                return new ArrayList<>(java.util.Arrays.asList("api_cache", "local_storage", "indexeddb"));
            }
            return types;
        }
        public void setTypes(List<String> types) { this.types = types; }

        public boolean isForce() { return force; }
        public void setForce(boolean force) { this.force = force; }
    }

    // 响应DTO
    public static class ClearCacheResponse {
        private boolean success;
        private String message;
        private ClearCacheData data;

        public ClearCacheResponse(boolean success, String message, ClearCacheData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public ClearCacheData getData() { return data; }
        public void setData(ClearCacheData data) { this.data = data; }
    }

    public static class ClearCacheData {
        private boolean success;
        private List<String> clearedTypes;
        private CacheStatistics statistics;
        private double totalFreedSpace;
        private double executionTime;
        private String message;

        public ClearCacheData(boolean success, List<String> clearedTypes, CacheStatistics statistics,
                              double totalFreedSpace, double executionTime, String message) {
            this.success = success;
            this.clearedTypes = clearedTypes;
            this.statistics = statistics;
            this.totalFreedSpace = totalFreedSpace;
            this.executionTime = executionTime;
            this.message = message;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public List<String> getClearedTypes() { return clearedTypes; }
        public void setClearedTypes(List<String> clearedTypes) { this.clearedTypes = clearedTypes; }

        public CacheStatistics getStatistics() { return statistics; }
        public void setStatistics(CacheStatistics statistics) { this.statistics = statistics; }

        public double getTotalFreedSpace() { return totalFreedSpace; }
        public void setTotalFreedSpace(double totalFreedSpace) { this.totalFreedSpace = totalFreedSpace; }

        public double getExecutionTime() { return executionTime; }
        public void setExecutionTime(double executionTime) { this.executionTime = executionTime; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }
    }

    public static class CacheStatistics {
        private CacheInfo apiCache;
        private CacheInfo localStorage;
        private CacheInfo indexedDB;

        public CacheStatistics(CacheInfo apiCache, CacheInfo localStorage, CacheInfo indexedDB) {
            this.apiCache = apiCache;
            this.localStorage = localStorage;
            this.indexedDB = indexedDB;
        }

        public CacheInfo getApiCache() { return apiCache; }
        public void setApiCache(CacheInfo apiCache) { this.apiCache = apiCache; }

        public CacheInfo getLocalStorage() { return localStorage; }
        public void setLocalStorage(CacheInfo localStorage) { this.localStorage = localStorage; }

        public CacheInfo getIndexedDB() { return indexedDB; }
        public void setIndexedDB(CacheInfo indexedDB) { this.indexedDB = indexedDB; }
    }

    public static class CacheInfo {
        private int entries;
        private String size;

        public CacheInfo(int entries, String size) {
            this.entries = entries;
            this.size = size;
        }

        public int getEntries() { return entries; }
        public void setEntries(int entries) { this.entries = entries; }

        public String getSize() { return size; }
        public void setSize(String size) { this.size = size; }
    }

    @DeleteMapping("/cache")
    public ResponseEntity<ClearCacheResponse> clearCache(@RequestBody(required = false) ClearCacheRequest requestBody) {

        // 创建请求对象
        ClearCacheRequest request = new ClearCacheRequest();
        if (requestBody != null) {
            request.setTypes(requestBody.getTypes());
            request.setForce(requestBody.isForce());
        }

        // 打印接收到的请求
        printRequest(request);

        try {
            LocalDateTime startTime = LocalDateTime.now();

            // 1. 获取要清理的缓存类型
            List<String> clearedTypes = new ArrayList<>();
            List<String> typesToClear = request.getTypes();

            // 2. 模拟清理各种缓存类型
            for (String type : typesToClear) {
                switch (type) {
                    case "api_cache":
                        clearedTypes.add("api_cache");
                        System.out.println("清理API缓存...");
                        break;
                    case "local_storage":
                        clearedTypes.add("local_storage");
                        System.out.println("清理本地存储...");
                        break;
                    case "indexeddb":
                        clearedTypes.add("indexeddb");
                        System.out.println("清理IndexedDB...");
                        break;
                    default:
                        System.out.println("未知缓存类型: " + type);
                }
            }

            // 3. 模拟清理数据库中的缓存相关数据
            // 清理过期的会话
            String clearSessionsSql = "DELETE FROM user_sessions WHERE expires_at < NOW()";
            int sessionsCleared = jdbcTemplate.update(clearSessionsSql);
            System.out.println("清理过期会话: " + sessionsCleared + " 条");

            // 清理过期的密码重置令牌
            String clearTokensSql = "DELETE FROM password_reset_tokens WHERE expires_at < NOW()";
            int tokensCleared = jdbcTemplate.update(clearTokensSql);
            System.out.println("清理过期令牌: " + tokensCleared + " 条");

            // 清理旧的搜索历史（保留最近30天）
            String clearSearchHistorySql = "DELETE FROM search_history WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY)";
            int searchHistoryCleared = jdbcTemplate.update(clearSearchHistorySql);
            System.out.println("清理旧搜索历史: " + searchHistoryCleared + " 条");

            // 清理旧的阅读历史（保留最近90天）
            String clearReadingHistorySql = "DELETE FROM reading_history WHERE start_time < DATE_SUB(NOW(), INTERVAL 90 DAY)";
            int readingHistoryCleared = jdbcTemplate.update(clearReadingHistorySql);
            System.out.println("清理旧阅读历史: " + readingHistoryCleared + " 条");

            // 4. 计算执行时间
            LocalDateTime endTime = LocalDateTime.now();
            double executionTime = (endTime.getNano() - startTime.getNano()) / 1_000_000_000.0;
            if (executionTime < 0) {
                executionTime = 1.0; // 如果时间差为负，设为1秒
            }

            // 5. 构建统计信息
            CacheInfo apiCacheInfo = new CacheInfo(1250, "50MB");
            CacheInfo localStorageInfo = new CacheInfo(500, "25MB");
            CacheInfo indexedDBInfo = new CacheInfo(0, "0MB");

            CacheStatistics statistics = new CacheStatistics(
                    apiCacheInfo,
                    localStorageInfo,
                    indexedDBInfo
            );

            // 6. 计算释放的空间（模拟）
            double totalFreedSpace = 75.0; // MB

            // 7. 构建响应数据
            ClearCacheData cacheData = new ClearCacheData(
                    true,
                    clearedTypes,
                    statistics,
                    totalFreedSpace,
                    executionTime,
                    "缓存清理完成"
            );

            ClearCacheResponse response = new ClearCacheResponse(true, "清理系统缓存成功", cacheData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("清理系统缓存过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new ClearCacheResponse(false, "清理系统缓存失败: " + e.getMessage(), null)
            );
        }
    }
}

--- 结束文件: SystemClearCache.java ---

--- 开始文件: SystemGetAnnouncements.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetAnnouncements {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取系统公告请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("=========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 响应DTO
    public static class AnnouncementsResponse {
        private boolean success;
        private String message;
        private AnnouncementsData data;

        public AnnouncementsResponse(boolean success, String message, AnnouncementsData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public AnnouncementsData getData() { return data; }
        public void setData(AnnouncementsData data) { this.data = data; }
    }

    public static class AnnouncementsData {
        private List<Announcement> announcements;
        private int unreadCount;

        public AnnouncementsData(List<Announcement> announcements, int unreadCount) {
            this.announcements = announcements;
            this.unreadCount = unreadCount;
        }

        public List<Announcement> getAnnouncements() { return announcements; }
        public void setAnnouncements(List<Announcement> announcements) { this.announcements = announcements; }

        public int getUnreadCount() { return unreadCount; }
        public void setUnreadCount(int unreadCount) { this.unreadCount = unreadCount; }
    }

    public static class Announcement {
        private String id;
        private String title;
        private String content;
        private String type;
        private String priority;
        private String targetAudience;
        private String startDate;
        private String endDate;
        private boolean isRead;
        private String actionUrl;
        private Map<String, Object> metadata;

        public Announcement(String id, String title, String content, String type, String priority,
                            String targetAudience, String startDate, String endDate, boolean isRead,
                            String actionUrl, Map<String, Object> metadata) {
            this.id = id;
            this.title = title;
            this.content = content;
            this.type = type;
            this.priority = priority;
            this.targetAudience = targetAudience;
            this.startDate = startDate;
            this.endDate = endDate;
            this.isRead = isRead;
            this.actionUrl = actionUrl;
            this.metadata = metadata;
        }

        public String getId() { return id; }
        public void setId(String id) { this.id = id; }

        public String getTitle() { return title; }
        public void setTitle(String title) { this.title = title; }

        public String getContent() { return content; }
        public void setContent(String content) { this.content = content; }

        public String getType() { return type; }
        public void setType(String type) { this.type = type; }

        public String getPriority() { return priority; }
        public void setPriority(String priority) { this.priority = priority; }

        public String getTargetAudience() { return targetAudience; }
        public void setTargetAudience(String targetAudience) { this.targetAudience = targetAudience; }

        public String getStartDate() { return startDate; }
        public void setStartDate(String startDate) { this.startDate = startDate; }

        public String getEndDate() { return endDate; }
        public void setEndDate(String endDate) { this.endDate = endDate; }

        public boolean isRead() { return isRead; }
        public void setRead(boolean read) { isRead = read; }

        public String getActionUrl() { return actionUrl; }
        public void setActionUrl(String actionUrl) { this.actionUrl = actionUrl; }

        public Map<String, Object> getMetadata() { return metadata; }
        public void setMetadata(Map<String, Object> metadata) { this.metadata = metadata; }
    }

    @GetMapping("/announcements")
    public ResponseEntity<AnnouncementsResponse> getAnnouncements() {
        // 打印接收到的请求
        printRequest("GET /api/system/announcements");

        try {
            // 1. 查询公告数据
            // 注意：数据库中没有专门的公告表，我们可以使用notifications表或创建一个新表
            // 这里我们假设使用notifications表，并且type为'announcement'
            String sql = "SELECT notification_id, user_id, title, content, type, is_read, created_at, metadata " +
                    "FROM notifications WHERE type = 'announcement' AND is_active = TRUE " +
                    "ORDER BY created_at DESC LIMIT 20";

            List<Map<String, Object>> announcementsData = jdbcTemplate.queryForList(sql);
            printQueryResult("查询到 " + announcementsData.size() + " 条公告记录");

            // 2. 构建公告列表
            List<Announcement> announcements = new ArrayList<>();
            int unreadCount = 0;

            for (Map<String, Object> announcementData : announcementsData) {
                String id = "ann_" + announcementData.get("notification_id");
                String title = (String) announcementData.get("title");
                String content = (String) announcementData.get("content");
                String type = (String) announcementData.get("type");
                Boolean isRead = (Boolean) announcementData.get("is_read");
                LocalDateTime createdAt = (LocalDateTime) announcementData.get("created_at");

                // 解析元数据
                Map<String, Object> metadata = new HashMap<>();
                String metadataStr = (String) announcementData.get("metadata");
                if (metadataStr != null && !metadataStr.trim().isEmpty()) {
                    // 简单解析JSON字符串（实际项目中应该使用JSON库）
                    if (metadataStr.contains("maintenanceDuration")) {
                        metadata.put("maintenanceDuration", "2h");
                        metadata.put("affectedServices", new String[]{"documents", "export"});
                    }
                }

                // 设置默认值
                String priority = "medium";
                String targetAudience = "all";
                String actionUrl = null;

                // 根据类型设置优先级
                if ("maintenance".equals(type)) {
                    priority = "high";
                } else if ("feature".equals(type)) {
                    priority = "low";
                }

                // 判断是否已读
                boolean readStatus = isRead != null ? isRead : false;
                if (!readStatus) {
                    unreadCount++;
                }

                // 计算结束时间（默认公告有效期为7天）
                LocalDateTime endDate = createdAt.plusDays(7);

                Announcement announcement = new Announcement(
                        id,
                        title,
                        content,
                        type,
                        priority,
                        targetAudience,
                        createdAt.format(DateTimeFormatter.ISO_DATE_TIME),
                        endDate.format(DateTimeFormatter.ISO_DATE_TIME),
                        readStatus,
                        actionUrl,
                        metadata
                );

                announcements.add(announcement);
            }

            // 3. 如果没有公告，添加一些示例公告
            if (announcements.isEmpty()) {
                announcements = createSampleAnnouncements();
                unreadCount = 2; // 示例中有2条未读公告
            }

            // 4. 构建响应数据
            AnnouncementsData announcementsDataObj = new AnnouncementsData(announcements, unreadCount);
            AnnouncementsResponse response = new AnnouncementsResponse(true, "获取系统公告成功", announcementsDataObj);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取系统公告过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new AnnouncementsResponse(false, "获取系统公告失败: " + e.getMessage(), null)
            );
        }
    }

    // 创建示例公告
    private List<Announcement> createSampleAnnouncements() {
        List<Announcement> announcements = new ArrayList<>();

        // 公告1：系统维护通知
        Map<String, Object> metadata1 = new HashMap<>();
        metadata1.put("maintenanceDuration", "2h");
        metadata1.put("affectedServices", new String[]{"documents", "export"});

        announcements.add(new Announcement(
                "ann_001",
                "系统维护通知",
                "我们将于2024年1月2日凌晨2:00-4:00进行系统维护，期间部分功能可能无法使用，请提前安排好学习计划。",
                "maintenance",
                "high",
                "all",
                LocalDateTime.now().minusDays(1).format(DateTimeFormatter.ISO_DATE_TIME),
                LocalDateTime.now().plusDays(6).format(DateTimeFormatter.ISO_DATE_TIME),
                false, // 未读
                null,
                metadata1
        ));

        // 公告2：新功能发布
        Map<String, Object> metadata2 = new HashMap<>();
        metadata2.put("version", "1.1.0");
        metadata2.put("releaseDate", "2024-01-01");

        announcements.add(new Announcement(
                "ann_002",
                "新功能发布：词汇复习算法升级",
                "我们升级了词汇复习算法，现在采用更科学的SM2算法，能够根据您的记忆情况智能安排复习计划，提高学习效率。",
                "feature",
                "medium",
                "all",
                LocalDateTime.now().minusDays(3).format(DateTimeFormatter.ISO_DATE_TIME),
                LocalDateTime.now().plusDays(4).format(DateTimeFormatter.ISO_DATE_TIME),
                false, // 未读
                "/features/sm2-algorithm",
                metadata2
        ));

        // 公告3：一般通知（已读）
        announcements.add(new Announcement(
                "ann_003",
                "应用使用指南更新",
                "我们更新了应用使用指南，新增了视频教程和常见问题解答，帮助您更好地使用本应用。",
                "info",
                "low",
                "all",
                LocalDateTime.now().minusDays(5).format(DateTimeFormatter.ISO_DATE_TIME),
                LocalDateTime.now().plusDays(2).format(DateTimeFormatter.ISO_DATE_TIME),
                true, // 已读
                "/help",
                new HashMap<>()
        ));

        return announcements;
    }
}

--- 结束文件: SystemGetAnnouncements.java ---

--- 开始文件: SystemGetAPIDocumentation.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetAPIDocumentation {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取API文档请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class APIDocsRequest {
        private String version;
        private String format;

        public String getVersion() { return version != null ? version : "v1"; }
        public void setVersion(String version) { this.version = version; }

        public String getFormat() { return format != null ? format : "json"; }
        public void setFormat(String format) { this.format = format; }
    }

    // 响应DTO
    public static class APIDocsResponse {
        private boolean success;
        private String message;
        private APIDocsData data;

        public APIDocsResponse(boolean success, String message, APIDocsData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public APIDocsData getData() { return data; }
        public void setData(APIDocsData data) { this.data = data; }
    }

    public static class APIDocsData {
        private String version;
        private String baseUrl;
        private List<APIEndpoint> endpoints;
        private Map<String, Object> definitions;

        public APIDocsData(String version, String baseUrl, List<APIEndpoint> endpoints, Map<String, Object> definitions) {
            this.version = version;
            this.baseUrl = baseUrl;
            this.endpoints = endpoints;
            this.definitions = definitions;
        }

        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }

        public String getBaseUrl() { return baseUrl; }
        public void setBaseUrl(String baseUrl) { this.baseUrl = baseUrl; }

        public List<APIEndpoint> getEndpoints() { return endpoints; }
        public void setEndpoints(List<APIEndpoint> endpoints) { this.endpoints = endpoints; }

        public Map<String, Object> getDefinitions() { return definitions; }
        public void setDefinitions(Map<String, Object> definitions) { this.definitions = definitions; }
    }

    public static class APIEndpoint {
        private String path;
        private String method;
        private String description;
        private List<APIParameter> parameters;
        private Map<String, APIResponse> responses;

        public APIEndpoint(String path, String method, String description,
                           List<APIParameter> parameters, Map<String, APIResponse> responses) {
            this.path = path;
            this.method = method;
            this.description = description;
            this.parameters = parameters;
            this.responses = responses;
        }

        public String getPath() { return path; }
        public void setPath(String path) { this.path = path; }

        public String getMethod() { return method; }
        public void setMethod(String method) { this.method = method; }

        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }

        public List<APIParameter> getParameters() { return parameters; }
        public void setParameters(List<APIParameter> parameters) { this.parameters = parameters; }

        public Map<String, APIResponse> getResponses() { return responses; }
        public void setResponses(Map<String, APIResponse> responses) { this.responses = responses; }
    }

    public static class APIParameter {
        private String name;
        private String type;
        private boolean required;
        private String description;

        public APIParameter(String name, String type, boolean required, String description) {
            this.name = name;
            this.type = type;
            this.required = required;
            this.description = description;
        }

        public String getName() { return name; }
        public void setName(String name) { this.name = name; }

        public String getType() { return type; }
        public void setType(String type) { this.type = type; }

        public boolean isRequired() { return required; }
        public void setRequired(boolean required) { this.required = required; }

        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }
    }

    public static class APIResponse {
        private String description;
        private Map<String, Object> schema;

        public APIResponse(String description, Map<String, Object> schema) {
            this.description = description;
            this.schema = schema;
        }

        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }

        public Map<String, Object> getSchema() { return schema; }
        public void setSchema(Map<String, Object> schema) { this.schema = schema; }
    }

    @GetMapping("/api-docs")
    public ResponseEntity<APIDocsResponse> getAPIDocumentation(@RequestParam(required = false) String version,
                                                               @RequestParam(required = false) String format) {

        // 创建请求对象
        APIDocsRequest request = new APIDocsRequest();
        request.setVersion(version);
        request.setFormat(format);

        // 打印接收到的请求
        printRequest(request);

        try {
            // 1. 构建API文档数据
            String baseUrl = "http://localhost:8080/api";

            // 2. 创建端点列表
            List<APIEndpoint> endpoints = new ArrayList<>();

            // 认证端点
            endpoints.add(createAuthLoginEndpoint());
            endpoints.add(createAuthRegisterEndpoint());
            endpoints.add(createAuthLogoutEndpoint());

            // 文档端点
            endpoints.add(createDocumentsGetEndpoint());
            endpoints.add(createDocumentsUploadEndpoint());

            // 系统端点
            endpoints.add(createSystemVersionEndpoint());
            endpoints.add(createSystemStatusEndpoint());
            endpoints.add(createSystemFAQEndpoint());

            // 3. 创建定义
            Map<String, Object> definitions = new HashMap<>();
            definitions.put("Document", createDocumentDefinition());
            definitions.put("User", createUserDefinition());
            definitions.put("VersionInfo", createVersionInfoDefinition());

            // 4. 构建响应数据
            APIDocsData docsData = new APIDocsData(
                    request.getVersion(),
                    baseUrl,
                    endpoints,
                    definitions
            );

            APIDocsResponse response = new APIDocsResponse(true, "获取API文档成功", docsData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取API文档过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            // 返回空文档
            APIDocsData errorData = new APIDocsData("v1", "error", new ArrayList<>(), new HashMap<>());
            APIDocsResponse errorResponse = new APIDocsResponse(false, "获取API文档失败: " + e.getMessage(), errorData);
            printResponse(errorResponse);

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }

    // 创建认证登录端点
    private APIEndpoint createAuthLoginEndpoint() {
        List<APIParameter> parameters = new ArrayList<>();
        parameters.add(new APIParameter("email", "string", true, "用户邮箱"));
        parameters.add(new APIParameter("password", "string", true, "用户密码"));

        Map<String, APIResponse> responses = new HashMap<>();

        Map<String, Object> successSchema = new HashMap<>();
        successSchema.put("type", "object");

        Map<String, Object> properties = new HashMap<>();
        properties.put("success", createSchemaProperty("boolean", "是否成功"));
        properties.put("message", createSchemaProperty("string", "消息"));

        Map<String, Object> dataProperties = new HashMap<>();
        dataProperties.put("access_token", createSchemaProperty("string", "访问令牌"));
        dataProperties.put("refresh_token", createSchemaProperty("string", "刷新令牌"));
        dataProperties.put("expires_in", createSchemaProperty("integer", "过期时间（秒）"));

        Map<String, Object> dataSchema = new HashMap<>();
        dataSchema.put("type", "object");
        dataSchema.put("properties", dataProperties);

        properties.put("data", dataSchema);
        successSchema.put("properties", properties);

        responses.put("200", new APIResponse("登录成功", successSchema));
        responses.put("400", new APIResponse("请求参数错误", null));
        responses.put("401", new APIResponse("邮箱或密码错误", null));

        return new APIEndpoint(
                "/auth/login",
                "POST",
                "用户登录",
                parameters,
                responses
        );
    }

    // 创建认证注册端点
    private APIEndpoint createAuthRegisterEndpoint() {
        List<APIParameter> parameters = new ArrayList<>();
        parameters.add(new APIParameter("username", "string", true, "用户名"));
        parameters.add(new APIParameter("email", "string", true, "用户邮箱"));
        parameters.add(new APIParameter("password", "string", true, "用户密码"));
        parameters.add(new APIParameter("nickname", "string", false, "用户昵称"));

        Map<String, APIResponse> responses = new HashMap<>();
        responses.put("200", new APIResponse("注册成功", null));
        responses.put("400", new APIResponse("请求参数错误", null));
        responses.put("409", new APIResponse("邮箱已存在", null));

        return new APIEndpoint(
                "/auth/register",
                "POST",
                "用户注册",
                parameters,
                responses
        );
    }

    // 创建认证登出端点
    private APIEndpoint createAuthLogoutEndpoint() {
        List<APIParameter> parameters = new ArrayList<>();
        parameters.add(new APIParameter("Authorization", "string", true, "Bearer令牌"));

        Map<String, APIResponse> responses = new HashMap<>();
        responses.put("200", new APIResponse("登出成功", null));
        responses.put("401", new APIResponse("未授权", null));

        return new APIEndpoint(
                "/auth/logout",
                "POST",
                "用户登出",
                parameters,
                responses
        );
    }

    // 创建文档获取端点
    private APIEndpoint createDocumentsGetEndpoint() {
        List<APIParameter> parameters = new ArrayList<>();
        parameters.add(new APIParameter("page", "integer", false, "页码"));
        parameters.add(new APIParameter("pageSize", "integer", false, "每页数量"));
        parameters.add(new APIParameter("status", "string", false, "文档状态"));
        parameters.add(new APIParameter("search", "string", false, "搜索关键词"));

        Map<String, APIResponse> responses = new HashMap<>();
        responses.put("200", new APIResponse("获取文档列表成功", null));
        responses.put("401", new APIResponse("未授权", null));

        return new APIEndpoint(
                "/documents",
                "GET",
                "获取文档列表",
                parameters,
                responses
        );
    }

    // 创建文档上传端点
    private APIEndpoint createDocumentsUploadEndpoint() {
        List<APIParameter> parameters = new ArrayList<>();
        parameters.add(new APIParameter("file", "file", true, "文档文件"));
        parameters.add(new APIParameter("title", "string", false, "文档标题"));
        parameters.add(new APIParameter("description", "string", false, "文档描述"));

        Map<String, APIResponse> responses = new HashMap<>();
        responses.put("200", new APIResponse("文档上传成功", null));
        responses.put("400", new APIResponse("文件格式不支持", null));
        responses.put("401", new APIResponse("未授权", null));

        return new APIEndpoint(
                "/documents/upload",
                "POST",
                "上传文档",
                parameters,
                responses
        );
    }

    // 创建系统版本端点
    private APIEndpoint createSystemVersionEndpoint() {
        List<APIParameter> parameters = new ArrayList<>();

        Map<String, APIResponse> responses = new HashMap<>();
        responses.put("200", new APIResponse("获取版本信息成功", null));

        return new APIEndpoint(
                "/system/version",
                "GET",
                "获取系统版本信息",
                parameters,
                responses
        );
    }

    // 创建系统状态端点
    private APIEndpoint createSystemStatusEndpoint() {
        List<APIParameter> parameters = new ArrayList<>();

        Map<String, APIResponse> responses = new HashMap<>();
        responses.put("200", new APIResponse("获取系统状态成功", null));

        return new APIEndpoint(
                "/system/status",
                "GET",
                "获取系统状态",
                parameters,
                responses
        );
    }

    // 创建系统FAQ端点
    private APIEndpoint createSystemFAQEndpoint() {
        List<APIParameter> parameters = new ArrayList<>();
        parameters.add(new APIParameter("page", "integer", false, "页码"));
        parameters.add(new APIParameter("pageSize", "integer", false, "每页数量"));
        parameters.add(new APIParameter("category", "string", false, "分类"));
        parameters.add(new APIParameter("search", "string", false, "搜索关键词"));

        Map<String, APIResponse> responses = new HashMap<>();
        responses.put("200", new APIResponse("获取常见问题成功", null));

        return new APIEndpoint(
                "/system/faq",
                "GET",
                "获取常见问题",
                parameters,
                responses
        );
    }

    // 创建文档定义
    private Map<String, Object> createDocumentDefinition() {
        Map<String, Object> definition = new HashMap<>();
        definition.put("type", "object");

        Map<String, Object> properties = new HashMap<>();
        properties.put("id", createSchemaProperty("string", "文档ID"));
        properties.put("title", createSchemaProperty("string", "文档标题"));
        properties.put("content", createSchemaProperty("string", "文档内容"));
        properties.put("status", createSchemaProperty("string", "文档状态"));
        properties.put("createdAt", createSchemaProperty("string", "创建时间"));
        properties.put("updatedAt", createSchemaProperty("string", "更新时间"));

        definition.put("properties", properties);
        return definition;
    }

    // 创建用户定义
    private Map<String, Object> createUserDefinition() {
        Map<String, Object> definition = new HashMap<>();
        definition.put("type", "object");

        Map<String, Object> properties = new HashMap<>();
        properties.put("id", createSchemaProperty("string", "用户ID"));
        properties.put("username", createSchemaProperty("string", "用户名"));
        properties.put("email", createSchemaProperty("string", "邮箱"));
        properties.put("nickname", createSchemaProperty("string", "昵称"));
        properties.put("avatar", createSchemaProperty("string", "头像URL"));
        properties.put("role", createSchemaProperty("string", "角色"));
        properties.put("createdAt", createSchemaProperty("string", "创建时间"));

        definition.put("properties", properties);
        return definition;
    }

    // 创建版本信息定义
    private Map<String, Object> createVersionInfoDefinition() {
        Map<String, Object> definition = new HashMap<>();
        definition.put("type", "object");

        Map<String, Object> properties = new HashMap<>();
        properties.put("version", createSchemaProperty("string", "版本号"));
        properties.put("buildNumber", createSchemaProperty("string", "构建号"));
        properties.put("commitHash", createSchemaProperty("string", "提交哈希"));
        properties.put("releaseDate", createSchemaProperty("string", "发布日期"));
        properties.put("latestVersion", createSchemaProperty("string", "最新版本"));
        properties.put("updateAvailable", createSchemaProperty("boolean", "是否有更新"));
        properties.put("updateUrl", createSchemaProperty("string", "更新URL"));
        properties.put("changelogUrl", createSchemaProperty("string", "更新日志URL"));
        properties.put("supportPeriod", createSchemaProperty("string", "支持周期"));

        definition.put("properties", properties);
        return definition;
    }

    // 创建模式属性
    private Map<String, Object> createSchemaProperty(String type, String description) {
        Map<String, Object> property = new HashMap<>();
        property.put("type", type);
        property.put("description", description);
        return property;
    }
}

--- 结束文件: SystemGetAPIDocumentation.java ---

--- 开始文件: SystemGetChangelog.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetChangelog {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取更新日志请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class ChangelogRequest {
        private String version;
        private Integer limit;

        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }

        public Integer getLimit() { return limit != null ? limit : 50; }
        public void setLimit(Integer limit) { this.limit = limit; }
    }

    // 响应DTO
    public static class ChangelogResponse {
        private boolean success;
        private String message;
        private ChangelogData data;

        public ChangelogResponse(boolean success, String message, ChangelogData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public ChangelogData getData() { return data; }
        public void setData(ChangelogData data) { this.data = data; }
    }

    public static class ChangelogData {
        private String version;
        private String releaseDate;
        private List<ChangeItem> changes;
        private List<Contributor> contributors;

        public ChangelogData(String version, String releaseDate, List<ChangeItem> changes, List<Contributor> contributors) {
            this.version = version;
            this.releaseDate = releaseDate;
            this.changes = changes;
            this.contributors = contributors;
        }

        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }

        public String getReleaseDate() { return releaseDate; }
        public void setReleaseDate(String releaseDate) { this.releaseDate = releaseDate; }

        public List<ChangeItem> getChanges() { return changes; }
        public void setChanges(List<ChangeItem> changes) { this.changes = changes; }

        public List<Contributor> getContributors() { return contributors; }
        public void setContributors(List<Contributor> contributors) { this.contributors = contributors; }
    }

    public static class ChangeItem {
        private String type;
        private String description;
        private String details;

        public ChangeItem(String type, String description, String details) {
            this.type = type;
            this.description = description;
            this.details = details;
        }

        public String getType() { return type; }
        public void setType(String type) { this.type = type; }

        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }

        public String getDetails() { return details; }
        public void setDetails(String details) { this.details = details; }
    }

    public static class Contributor {
        private String name;
        private String email;
        private List<String> contributions;

        public Contributor(String name, String email, List<String> contributions) {
            this.name = name;
            this.email = email;
            this.contributions = contributions;
        }

        public String getName() { return name; }
        public void setName(String name) { this.name = name; }

        public String getEmail() { return email; }
        public void setEmail(String email) { this.email = email; }

        public List<String> getContributions() { return contributions; }
        public void setContributions(List<String> contributions) { this.contributions = contributions; }
    }

    @GetMapping("/changelog")
    public ResponseEntity<ChangelogResponse> getChangelog(@RequestParam(required = false) String version,
                                                          @RequestParam(required = false) Integer limit) {

        // 创建请求对象
        ChangelogRequest request = new ChangelogRequest();
        request.setVersion(version);
        request.setLimit(limit);

        // 打印接收到的请求
        printRequest(request);

        try {
            // 1. 构建查询条件
            StringBuilder sqlBuilder = new StringBuilder();
            sqlBuilder.append("SELECT version_id, version_number, release_date, release_notes, is_forced_update, created_at FROM app_versions");

            List<Object> params = new ArrayList<>();

            if (version != null && !version.trim().isEmpty()) {
                sqlBuilder.append(" WHERE version_number = ?");
                params.add(version);
            }

            sqlBuilder.append(" ORDER BY release_date DESC");

            if (request.getLimit() > 0) {
                sqlBuilder.append(" LIMIT ?");
                params.add(request.getLimit());
            }

            // 2. 查询版本数据
            List<Map<String, Object>> versions = jdbcTemplate.queryForList(sqlBuilder.toString(), params.toArray());
            printQueryResult("查询到 " + versions.size() + " 个版本记录");

            if (versions.isEmpty()) {
                return ResponseEntity.status(HttpStatus.NOT_FOUND).body(
                        new ChangelogResponse(false, "未找到版本信息", null)
                );
            }

            // 3. 获取第一个版本（最新或指定版本）
            Map<String, Object> versionData = versions.get(0);

            String versionNumber = (String) versionData.get("version_number");
            LocalDateTime releaseDate = (LocalDateTime) versionData.get("release_date");
            String releaseNotes = (String) versionData.get("release_notes");

            // 4. 解析更新日志
            List<ChangeItem> changes = parseReleaseNotes(releaseNotes);

            // 5. 构建贡献者列表（模拟数据）
            List<Contributor> contributors = buildContributors(versionNumber);

            // 6. 构建响应数据
            ChangelogData changelogData = new ChangelogData(
                    versionNumber,
                    releaseDate.format(DateTimeFormatter.ISO_DATE_TIME),
                    changes,
                    contributors
            );

            ChangelogResponse response = new ChangelogResponse(true, "获取更新日志成功", changelogData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取更新日志过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new ChangelogResponse(false, "获取更新日志失败: " + e.getMessage(), null)
            );
        }
    }

    // 解析发布说明
    private List<ChangeItem> parseReleaseNotes(String releaseNotes) {
        List<ChangeItem> changes = new ArrayList<>();

        if (releaseNotes == null || releaseNotes.trim().isEmpty()) {
            // 如果没有发布说明，返回默认的更新日志
            changes.add(new ChangeItem("feature", "系统初始版本", "Vue Reading App 正式上线"));
            changes.add(new ChangeItem("improvement", "优化系统性能", "提升系统响应速度和稳定性"));
            changes.add(new ChangeItem("bugfix", "修复已知问题", "解决了一些已知的bug和问题"));
            return changes;
        }

        // 尝试按行解析发布说明
        String[] lines = releaseNotes.split("\n");
        for (String line : lines) {
            line = line.trim();
            if (line.isEmpty()) continue;

            // 尝试解析类型和描述
            String type = "update";
            String description = line;
            String details = "";

            // 检查是否有类型标记，如 [feature], [bugfix], [improvement]
            if (line.startsWith("[") && line.contains("]")) {
                int endIndex = line.indexOf("]");
                String typeTag = line.substring(1, endIndex).toLowerCase();

                // 常见类型
                if (typeTag.equals("feature") || typeTag.equals("bugfix") ||
                        typeTag.equals("improvement") || typeTag.equals("security") ||
                        typeTag.equals("performance") || typeTag.equals("documentation")) {
                    type = typeTag;
                    description = line.substring(endIndex + 1).trim();
                }
            }

            // 检查是否有冒号分隔描述和详情
            if (description.contains("：")) {
                int colonIndex = description.indexOf("：");
                details = description.substring(colonIndex + 1).trim();
                description = description.substring(0, colonIndex).trim();
            } else if (description.contains(":")) {
                int colonIndex = description.indexOf(":");
                details = description.substring(colonIndex + 1).trim();
                description = description.substring(0, colonIndex).trim();
            }

            changes.add(new ChangeItem(type, description, details));
        }

        // 如果没有解析到任何内容，添加默认项
        if (changes.isEmpty()) {
            changes.add(new ChangeItem("update", "版本更新", releaseNotes));
        }

        return changes;
    }

    // 构建贡献者列表
    private List<Contributor> buildContributors(String version) {
        List<Contributor> contributors = new ArrayList<>();

        // 模拟贡献者数据
        if (version.startsWith("1.0")) {
            List<String> devContributions = new ArrayList<>();
            devContributions.add("feature");
            devContributions.add("bugfix");
            devContributions.add("improvement");

            contributors.add(new Contributor("张三", "zhangsan@example.com", devContributions));

            List<String> uiContributions = new ArrayList<>();
            uiContributions.add("ui");
            uiContributions.add("design");

            contributors.add(new Contributor("李四", "lisi@example.com", uiContributions));

            List<String> testContributions = new ArrayList<>();
            testContributions.add("testing");
            testContributions.add("qa");

            contributors.add(new Contributor("王五", "wangwu@example.com", testContributions));
        } else if (version.startsWith("1.1")) {
            List<String> devContributions = new ArrayList<>();
            devContributions.add("feature");
            devContributions.add("performance");

            contributors.add(new Contributor("赵六", "zhaoliu@example.com", devContributions));

            List<String> docContributions = new ArrayList<>();
            docContributions.add("documentation");

            contributors.add(new Contributor("钱七", "qianqi@example.com", docContributions));
        }

        return contributors;
    }
}
--- 结束文件: SystemGetChangelog.java ---

--- 开始文件: SystemGetConfig.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.util.Map;
import java.util.HashMap;
import java.util.List;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetConfig {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取系统配置请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 响应DTO
    public static class ConfigResponse {
        private boolean success;
        private String message;
        private ConfigData data;

        public ConfigResponse(boolean success, String message, ConfigData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public ConfigData getData() { return data; }
        public void setData(ConfigData data) { this.data = data; }
    }

    public static class ConfigData {
        private Features features;
        private Limits limits;
        private Maintenance maintenance;

        public ConfigData(Features features, Limits limits, Maintenance maintenance) {
            this.features = features;
            this.limits = limits;
            this.maintenance = maintenance;
        }

        public Features getFeatures() { return features; }
        public void setFeatures(Features features) { this.features = features; }

        public Limits getLimits() { return limits; }
        public void setLimits(Limits limits) { this.limits = limits; }

        public Maintenance getMaintenance() { return maintenance; }
        public void setMaintenance(Maintenance maintenance) { this.maintenance = maintenance; }
    }

    public static class Features {
        private DocumentFeatures documents;
        private VocabularyFeatures vocabulary;
        private ExportFeatures export;

        public Features(DocumentFeatures documents, VocabularyFeatures vocabulary, ExportFeatures export) {
            this.documents = documents;
            this.vocabulary = vocabulary;
            this.export = export;
        }

        public DocumentFeatures getDocuments() { return documents; }
        public void setDocuments(DocumentFeatures documents) { this.documents = documents; }

        public VocabularyFeatures getVocabulary() { return vocabulary; }
        public void setVocabulary(VocabularyFeatures vocabulary) { this.vocabulary = vocabulary; }

        public ExportFeatures getExport() { return export; }
        public void setExport(ExportFeatures export) { this.export = export; }
    }

    public static class DocumentFeatures {
        private boolean enabled;
        private String maxFileSize;
        private List<String> allowedFormats;

        public DocumentFeatures(boolean enabled, String maxFileSize, List<String> allowedFormats) {
            this.enabled = enabled;
            this.maxFileSize = maxFileSize;
            this.allowedFormats = allowedFormats;
        }

        public boolean isEnabled() { return enabled; }
        public void setEnabled(boolean enabled) { this.enabled = enabled; }

        public String getMaxFileSize() { return maxFileSize; }
        public void setMaxFileSize(String maxFileSize) { this.maxFileSize = maxFileSize; }

        public List<String> getAllowedFormats() { return allowedFormats; }
        public void setAllowedFormats(List<String> allowedFormats) { this.allowedFormats = allowedFormats; }
    }

    public static class VocabularyFeatures {
        private boolean enabled;
        private int maxWordsPerList;
        private boolean autoDetectLanguage;

        public VocabularyFeatures(boolean enabled, int maxWordsPerList, boolean autoDetectLanguage) {
            this.enabled = enabled;
            this.maxWordsPerList = maxWordsPerList;
            this.autoDetectLanguage = autoDetectLanguage;
        }

        public boolean isEnabled() { return enabled; }
        public void setEnabled(boolean enabled) { this.enabled = enabled; }

        public int getMaxWordsPerList() { return maxWordsPerList; }
        public void setMaxWordsPerList(int maxWordsPerList) { this.maxWordsPerList = maxWordsPerList; }

        public boolean isAutoDetectLanguage() { return autoDetectLanguage; }
        public void setAutoDetectLanguage(boolean autoDetectLanguage) { this.autoDetectLanguage = autoDetectLanguage; }
    }

    public static class ExportFeatures {
        private boolean enabled;
        private String maxExportSize;
        private List<String> allowedFormats;

        public ExportFeatures(boolean enabled, String maxExportSize, List<String> allowedFormats) {
            this.enabled = enabled;
            this.maxExportSize = maxExportSize;
            this.allowedFormats = allowedFormats;
        }

        public boolean isEnabled() { return enabled; }
        public void setEnabled(boolean enabled) { this.enabled = enabled; }

        public String getMaxExportSize() { return maxExportSize; }
        public void setMaxExportSize(String maxExportSize) { this.maxExportSize = maxExportSize; }

        public List<String> getAllowedFormats() { return allowedFormats; }
        public void setAllowedFormats(List<String> allowedFormats) { this.allowedFormats = allowedFormats; }
    }

    public static class Limits {
        private int maxDocuments;
        private int maxVocabularyWords;
        private int maxReviewsPerDay;

        public Limits(int maxDocuments, int maxVocabularyWords, int maxReviewsPerDay) {
            this.maxDocuments = maxDocuments;
            this.maxVocabularyWords = maxVocabularyWords;
            this.maxReviewsPerDay = maxReviewsPerDay;
        }

        public int getMaxDocuments() { return maxDocuments; }
        public void setMaxDocuments(int maxDocuments) { this.maxDocuments = maxDocuments; }

        public int getMaxVocabularyWords() { return maxVocabularyWords; }
        public void setMaxVocabularyWords(int maxVocabularyWords) { this.maxVocabularyWords = maxVocabularyWords; }

        public int getMaxReviewsPerDay() { return maxReviewsPerDay; }
        public void setMaxReviewsPerDay(int maxReviewsPerDay) { this.maxReviewsPerDay = maxReviewsPerDay; }
    }

    public static class Maintenance {
        private boolean enabled;
        private String scheduledTime;
        private String duration;

        public Maintenance(boolean enabled, String scheduledTime, String duration) {
            this.enabled = enabled;
            this.scheduledTime = scheduledTime;
            this.duration = duration;
        }

        public boolean isEnabled() { return enabled; }
        public void setEnabled(boolean enabled) { this.enabled = enabled; }

        public String getScheduledTime() { return scheduledTime; }
        public void setScheduledTime(String scheduledTime) { this.scheduledTime = scheduledTime; }

        public String getDuration() { return duration; }
        public void setDuration(String duration) { this.duration = duration; }
    }

    @GetMapping("/config")
    public ResponseEntity<ConfigResponse> getConfig() {
        // 打印接收到的请求
        printRequest("GET /api/system/config");

        try {
            // 1. 查询用户限制表
            String limitsSql = "SELECT limit_type, limit_value FROM user_limits WHERE user_type = 'free'";
            List<Map<String, Object>> limitsData = jdbcTemplate.queryForList(limitsSql);
            printQueryResult("用户限制数据: " + limitsData);

            // 2. 解析限制数据
            int maxDocuments = 1000;
            int maxVocabularyWords = 10000;
            int maxReviewsPerDay = 500;

            for (Map<String, Object> limit : limitsData) {
                String limitType = (String) limit.get("limit_type");
                int limitValue = (Integer) limit.get("limit_value");

                switch (limitType) {
                    case "max_documents":
                        maxDocuments = limitValue;
                        break;
                    case "max_vocabulary_words":
                        maxVocabularyWords = limitValue;
                        break;
                    case "max_reviews_per_day":
                        maxReviewsPerDay = limitValue;
                        break;
                }
            }

            // 3. 构建文档功能配置
            List<String> documentFormats = new java.util.ArrayList<>();
            documentFormats.add("pdf");
            documentFormats.add("docx");
            documentFormats.add("txt");
            documentFormats.add("epub");

            DocumentFeatures docFeatures = new DocumentFeatures(
                    true,
                    "10MB",
                    documentFormats
            );

            // 4. 构建词汇功能配置
            VocabularyFeatures vocabFeatures = new VocabularyFeatures(
                    true,
                    1000,
                    true
            );

            // 5. 构建导出功能配置
            List<String> exportFormats = new java.util.ArrayList<>();
            exportFormats.add("pdf");
            exportFormats.add("xlsx");
            exportFormats.add("csv");
            exportFormats.add("json");

            ExportFeatures exportFeatures = new ExportFeatures(
                    true,
                    "100MB",
                    exportFormats
            );

            // 6. 构建功能配置
            Features features = new Features(
                    docFeatures,
                    vocabFeatures,
                    exportFeatures
            );

            // 7. 构建限制配置
            Limits limits = new Limits(
                    maxDocuments,
                    maxVocabularyWords,
                    maxReviewsPerDay
            );

            // 8. 构建维护配置
            Maintenance maintenance = new Maintenance(
                    false,
                    LocalDateTime.now().plusDays(1).toString(),
                    "2h"
            );

            // 9. 构建响应数据
            ConfigData configData = new ConfigData(
                    features,
                    limits,
                    maintenance
            );

            ConfigResponse response = new ConfigResponse(true, "获取系统配置成功", configData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取系统配置过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            // 返回默认配置
            List<String> documentFormats = new java.util.ArrayList<>();
            documentFormats.add("pdf");
            documentFormats.add("docx");
            documentFormats.add("txt");

            DocumentFeatures docFeatures = new DocumentFeatures(true, "10MB", documentFormats);
            VocabularyFeatures vocabFeatures = new VocabularyFeatures(true, 1000, true);

            List<String> exportFormats = new java.util.ArrayList<>();
            exportFormats.add("pdf");
            exportFormats.add("csv");

            ExportFeatures exportFeatures = new ExportFeatures(true, "50MB", exportFormats);

            Features features = new Features(docFeatures, vocabFeatures, exportFeatures);
            Limits limits = new Limits(1000, 10000, 500);
            Maintenance maintenance = new Maintenance(false, "", "0h");

            ConfigData errorData = new ConfigData(features, limits, maintenance);
            ConfigResponse errorResponse = new ConfigResponse(false, "获取系统配置失败: " + e.getMessage(), errorData);
            printResponse(errorResponse);

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }
}

--- 结束文件: SystemGetConfig.java ---

--- 开始文件: SystemGetFAQ.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetFAQ {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取常见问题请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class FAQRequest {
        private Integer page;
        private Integer pageSize;
        private String category;
        private String search;

        public Integer getPage() { return page != null ? page : 1; }
        public void setPage(Integer page) { this.page = page; }

        public Integer getPageSize() { return pageSize != null ? pageSize : 20; }
        public void setPageSize(Integer pageSize) { this.pageSize = pageSize; }

        public String getCategory() { return category; }
        public void setCategory(String category) { this.category = category; }

        public String getSearch() { return search; }
        public void setSearch(String search) { this.search = search; }
    }

    // 响应DTO
    public static class FAQResponse {
        private boolean success;
        private String message;
        private FAQData data;

        public FAQResponse(boolean success, String message, FAQData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public FAQData getData() { return data; }
        public void setData(FAQData data) { this.data = data; }
    }

    public static class FAQData {
        private int total;
        private int page;
        private int pageSize;
        private int totalPages;
        private List<FAQItem> items;

        public FAQData(int total, int page, int pageSize, List<FAQItem> items) {
            this.total = total;
            this.page = page;
            this.pageSize = pageSize;
            this.totalPages = (int) Math.ceil((double) total / pageSize);
            this.items = items;
        }

        public int getTotal() { return total; }
        public void setTotal(int total) { this.total = total; }

        public int getPage() { return page; }
        public void setPage(int page) { this.page = page; }

        public int getPageSize() { return pageSize; }
        public void setPageSize(int pageSize) { this.pageSize = pageSize; }

        public int getTotalPages() { return totalPages; }
        public void setTotalPages(int totalPages) { this.totalPages = totalPages; }

        public List<FAQItem> getItems() { return items; }
        public void setItems(List<FAQItem> items) { this.items = items; }
    }

    public static class FAQItem {
        private String id;
        private String question;
        private String answer;
        private String category;
        private List<String> tags;
        private int viewCount;
        private int helpfulCount;
        private String createdAt;
        private String updatedAt;

        public FAQItem(String id, String question, String answer, String category,
                       List<String> tags, int viewCount, int helpfulCount,
                       String createdAt, String updatedAt) {
            this.id = id;
            this.question = question;
            this.answer = answer;
            this.category = category;
            this.tags = tags;
            this.viewCount = viewCount;
            this.helpfulCount = helpfulCount;
            this.createdAt = createdAt;
            this.updatedAt = updatedAt;
        }

        public String getId() { return id; }
        public void setId(String id) { this.id = id; }

        public String getQuestion() { return question; }
        public void setQuestion(String question) { this.question = question; }

        public String getAnswer() { return answer; }
        public void setAnswer(String answer) { this.answer = answer; }

        public String getCategory() { return category; }
        public void setCategory(String category) { this.category = category; }

        public List<String> getTags() { return tags; }
        public void setTags(List<String> tags) { this.tags = tags; }

        public int getViewCount() { return viewCount; }
        public void setViewCount(int viewCount) { this.viewCount = viewCount; }

        public int getHelpfulCount() { return helpfulCount; }
        public void setHelpfulCount(int helpfulCount) { this.helpfulCount = helpfulCount; }

        public String getCreatedAt() { return createdAt; }
        public void setCreatedAt(String createdAt) { this.createdAt = createdAt; }

        public String getUpdatedAt() { return updatedAt; }
        public void setUpdatedAt(String updatedAt) { this.updatedAt = updatedAt; }
    }

    @GetMapping("/faq")
    public ResponseEntity<FAQResponse> getFAQ(@RequestParam(required = false) Integer page,
                                              @RequestParam(required = false) Integer pageSize,
                                              @RequestParam(required = false) String category,
                                              @RequestParam(required = false) String search) {

        // 创建请求对象
        FAQRequest request = new FAQRequest();
        request.setPage(page);
        request.setPageSize(pageSize);
        request.setCategory(category);
        request.setSearch(search);

        // 打印接收到的请求
        printRequest(request);

        try {
            // 1. 构建查询条件
            StringBuilder sqlBuilder = new StringBuilder();
            sqlBuilder.append("SELECT faq_id, question, answer, category, order_index, is_active, created_at FROM faq WHERE is_active = TRUE");

            List<Object> params = new ArrayList<>();

            if (category != null && !category.trim().isEmpty()) {
                sqlBuilder.append(" AND category = ?");
                params.add(category);
            }

            if (search != null && !search.trim().isEmpty()) {
                sqlBuilder.append(" AND (question LIKE ? OR answer LIKE ?)");
                String searchPattern = "%" + search + "%";
                params.add(searchPattern);
                params.add(searchPattern);
            }

            sqlBuilder.append(" ORDER BY order_index, created_at DESC");

            // 2. 查询数据
            List<Map<String, Object>> faqList = jdbcTemplate.queryForList(sqlBuilder.toString(), params.toArray());
            printQueryResult("查询到 " + faqList.size() + " 条FAQ记录");

            // 3. 计算分页
            int currentPage = request.getPage();
            int currentPageSize = request.getPageSize();
            int totalItems = faqList.size();
            int startIndex = (currentPage - 1) * currentPageSize;
            int endIndex = Math.min(startIndex + currentPageSize, totalItems);

            // 4. 分页处理
            List<FAQItem> pagedItems = new ArrayList<>();
            for (int i = startIndex; i < endIndex && i < faqList.size(); i++) {
                Map<String, Object> faq = faqList.get(i);

                // 解析标签（这里简单处理，实际应该从关联表中查询）
                List<String> tags = new ArrayList<>();
                if (faq.get("category") != null) {
                    tags.add(faq.get("category").toString());
                }

                FAQItem item = new FAQItem(
                        "faq_" + faq.get("faq_id"),
                        (String) faq.get("question"),
                        (String) faq.get("answer"),
                        (String) faq.get("category"),
                        tags,
                        1250, // 模拟浏览次数
                        980,  // 模拟有帮助次数
                        ((LocalDateTime) faq.get("created_at")).format(DateTimeFormatter.ISO_DATE_TIME),
                        ((LocalDateTime) faq.get("created_at")).format(DateTimeFormatter.ISO_DATE_TIME)
                );

                pagedItems.add(item);
            }

            // 5. 构建响应数据
            FAQData faqData = new FAQData(totalItems, currentPage, currentPageSize, pagedItems);
            FAQResponse response = new FAQResponse(true, "获取常见问题成功", faqData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取常见问题过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            // 返回空数据
            FAQData errorData = new FAQData(0, 1, 20, new ArrayList<>());
            FAQResponse errorResponse = new FAQResponse(false, "获取常见问题失败: " + e.getMessage(), errorData);
            printResponse(errorResponse);

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }
}

--- 结束文件: SystemGetFAQ.java ---

--- 开始文件: SystemGetHealth.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetHealth {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取系统健康状态请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("============================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 响应DTO
    public static class HealthResponse {
        private boolean success;
        private String message;
        private HealthData data;

        public HealthResponse(boolean success, String message, HealthData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public HealthData getData() { return data; }
        public void setData(HealthData data) { this.data = data; }
    }

    public static class HealthData {
        private String overall;
        private List<HealthCheck> checks;
        private String timestamp;

        public HealthData(String overall, List<HealthCheck> checks, String timestamp) {
            this.overall = overall;
            this.checks = checks;
            this.timestamp = timestamp;
        }

        public String getOverall() { return overall; }
        public void setOverall(String overall) { this.overall = overall; }

        public List<HealthCheck> getChecks() { return checks; }
        public void setChecks(List<HealthCheck> checks) { this.checks = checks; }

        public String getTimestamp() { return timestamp; }
        public void setTimestamp(String timestamp) { this.timestamp = timestamp; }
    }

    public static class HealthCheck {
        private String name;
        private String status;
        private String details;
        private String lastChecked;

        public HealthCheck(String name, String status, String details, String lastChecked) {
            this.name = name;
            this.status = status;
            this.details = details;
            this.lastChecked = lastChecked;
        }

        public String getName() { return name; }
        public void setName(String name) { this.name = name; }

        public String getStatus() { return status; }
        public void setStatus(String status) { this.status = status; }

        public String getDetails() { return details; }
        public void setDetails(String details) { this.details = details; }

        public String getLastChecked() { return lastChecked; }
        public void setLastChecked(String lastChecked) { this.lastChecked = lastChecked; }
    }

    @GetMapping("/health")
    public ResponseEntity<HealthResponse> getHealth() {
        // 打印接收到的请求
        printRequest("GET /api/system/health");

        try {
            // 1. 检查数据库连接
            boolean dbHealthy = false;
            String dbDetails = "数据库连接失败";

            try {
                String testSql = "SELECT 1";
                jdbcTemplate.queryForObject(testSql, Integer.class);
                dbHealthy = true;
                dbDetails = "数据库连接正常";
            } catch (Exception e) {
                dbDetails = "数据库连接失败: " + e.getMessage();
            }

            // 2. 检查磁盘空间（模拟）
            boolean diskHealthy = true;
            String diskDetails = "磁盘使用率正常";

            // 3. 检查内存使用（模拟）
            boolean memoryHealthy = true;
            String memoryDetails = "内存使用率正常";

            // 4. 检查API服务（模拟）
            boolean apiHealthy = true;
            String apiDetails = "API服务运行正常";

            // 5. 构建健康检查列表
            List<HealthCheck> checks = new ArrayList<>();

            checks.add(new HealthCheck(
                    "database",
                    dbHealthy ? "healthy" : "unhealthy",
                    dbDetails,
                    LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME)
            ));

            checks.add(new HealthCheck(
                    "disk",
                    diskHealthy ? "healthy" : "warning",
                    diskDetails,
                    LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME)
            ));

            checks.add(new HealthCheck(
                    "memory",
                    memoryHealthy ? "healthy" : "warning",
                    memoryDetails,
                    LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME)
            ));

            checks.add(new HealthCheck(
                    "api",
                    apiHealthy ? "healthy" : "unhealthy",
                    apiDetails,
                    LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME)
            ));

            // 6. 确定整体状态
            String overallStatus = "healthy";
            for (HealthCheck check : checks) {
                if ("unhealthy".equals(check.getStatus())) {
                    overallStatus = "unhealthy";
                    break;
                } else if ("warning".equals(check.getStatus())) {
                    overallStatus = "warning";
                }
            }

            // 7. 构建响应数据
            HealthData healthData = new HealthData(
                    overallStatus,
                    checks,
                    LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME)
            );

            HealthResponse response = new HealthResponse(true, "获取系统健康状态成功", healthData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取系统健康状态过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            // 返回错误健康状态
            List<HealthCheck> errorChecks = new ArrayList<>();
            errorChecks.add(new HealthCheck(
                    "system",
                    "unhealthy",
                    "获取健康状态时发生错误: " + e.getMessage(),
                    LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME)
            ));

            HealthData errorData = new HealthData(
                    "unhealthy",
                    errorChecks,
                    LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME)
            );

            HealthResponse errorResponse = new HealthResponse(false, "获取系统健康状态失败", errorData);
            printResponse(errorResponse);

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }
}

--- 结束文件: SystemGetHealth.java ---

--- 开始文件: SystemGetHelpDocumentation.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetHelpDocumentation {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取帮助文档请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("=========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class HelpRequest {
        private String topic;
        private String language;

        public String getTopic() { return topic != null ? topic : "getting_started"; }
        public void setTopic(String topic) { this.topic = topic; }

        public String getLanguage() { return language != null ? language : "zh-CN"; }
        public void setLanguage(String language) { this.language = language; }
    }

    // 响应DTO
    public static class HelpResponse {
        private boolean success;
        private String message;
        private HelpData data;

        public HelpResponse(boolean success, String message, HelpData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public HelpData getData() { return data; }
        public void setData(HelpData data) { this.data = data; }
    }

    public static class HelpData {
        private String topic;
        private String language;
        private List<HelpSection> sections;

        public HelpData(String topic, String language, List<HelpSection> sections) {
            this.topic = topic;
            this.language = language;
            this.sections = sections;
        }

        public String getTopic() { return topic; }
        public void setTopic(String topic) { this.topic = topic; }

        public String getLanguage() { return language; }
        public void setLanguage(String language) { this.language = language; }

        public List<HelpSection> getSections() { return sections; }
        public void setSections(List<HelpSection> sections) { this.sections = sections; }
    }

    public static class HelpSection {
        private String title;
        private HelpContent content;

        public HelpSection(String title, HelpContent content) {
            this.title = title;
            this.content = content;
        }

        public String getTitle() { return title; }
        public void setTitle(String title) { this.title = title; }

        public HelpContent getContent() { return content; }
        public void setContent(HelpContent content) { this.content = content; }
    }

    public static class HelpContent {
        private String introduction;
        private List<HelpStep> steps;
        private List<String> tips;

        public HelpContent(String introduction, List<HelpStep> steps, List<String> tips) {
            this.introduction = introduction;
            this.steps = steps;
            this.tips = tips;
        }

        public String getIntroduction() { return introduction; }
        public void setIntroduction(String introduction) { this.introduction = introduction; }

        public List<HelpStep> getSteps() { return steps; }
        public void setSteps(List<HelpStep> steps) { this.steps = steps; }

        public List<String> getTips() { return tips; }
        public void setTips(List<String> tips) { this.tips = tips; }
    }

    public static class HelpStep {
        private int step;
        private String title;
        private String description;

        public HelpStep(int step, String title, String description) {
            this.step = step;
            this.title = title;
            this.description = description;
        }

        public int getStep() { return step; }
        public void setStep(int step) { this.step = step; }

        public String getTitle() { return title; }
        public void setTitle(String title) { this.title = title; }

        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }
    }

    @GetMapping("/help")
    public ResponseEntity<HelpResponse> getHelpDocumentation(@RequestParam(required = false) String topic,
                                                             @RequestParam(required = false) String language) {

        // 创建请求对象
        HelpRequest request = new HelpRequest();
        request.setTopic(topic);
        request.setLanguage(language);

        // 打印接收到的请求
        printRequest(request);

        try {
            // 1. 根据主题和语言构建帮助文档
            List<HelpSection> sections = buildHelpSections(request.getTopic(), request.getLanguage());

            // 2. 构建响应数据
            HelpData helpData = new HelpData(
                    request.getTopic(),
                    request.getLanguage(),
                    sections
            );

            HelpResponse response = new HelpResponse(true, "获取帮助文档成功", helpData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取帮助文档过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new HelpResponse(false, "获取帮助文档失败: " + e.getMessage(), null)
            );
        }
    }

    // 构建帮助文档章节
    private List<HelpSection> buildHelpSections(String topic, String language) {
        List<HelpSection> sections = new ArrayList<>();

        if ("getting_started".equals(topic)) {
            if ("zh-CN".equals(language)) {
                // 快速开始 - 中文
                List<HelpStep> steps = new ArrayList<>();
                steps.add(new HelpStep(1, "注册账户", "点击注册按钮，填写用户名、邮箱和密码完成注册。"));
                steps.add(new HelpStep(2, "验证邮箱", "检查您的邮箱，点击验证链接激活账户。"));
                steps.add(new HelpStep(3, "登录系统", "使用注册的邮箱和密码登录系统。"));
                steps.add(new HelpStep(4, "上传文档", "在文档页面点击上传按钮，选择PDF、Word或TXT文件。"));
                steps.add(new HelpStep(5, "开始阅读", "打开文档，使用阅读器开始学习。"));

                List<String> tips = new ArrayList<>();
                tips.add("建议使用Chrome浏览器以获得最佳体验");
                tips.add("首次使用时请查看帮助文档");
                tips.add("可以同时上传多个文档");
                tips.add("支持PDF、Word、TXT和EPUB格式");

                HelpContent content = new HelpContent(
                        "欢迎使用Vue Reading App！本指南将帮助您快速上手使用本应用。",
                        steps,
                        tips
                );

                sections.add(new HelpSection("快速开始", content));

                // 基本功能 - 中文
                List<HelpStep> basicSteps = new ArrayList<>();
                basicSteps.add(new HelpStep(1, "文档管理", "在文档页面可以查看、编辑、删除您上传的文档。"));
                basicSteps.add(new HelpStep(2, "词汇学习", "阅读时双击单词可以查看释义并添加到生词本。"));
                basicSteps.add(new HelpStep(3, "笔记功能", "选中文本可以添加高亮和笔记。"));
                basicSteps.add(new HelpStep(4, "复习系统", "系统会根据记忆曲线自动安排复习计划。"));

                List<String> basicTips = new ArrayList<>();
                basicTips.add("定期复习可以提高记忆效果");
                basicTips.add("使用标签可以更好地组织文档");
                basicTips.add("导出功能可以备份学习数据");

                HelpContent basicContent = new HelpContent(
                        "了解应用的基本功能，让学习更加高效。",
                        basicSteps,
                        basicTips
                );

                sections.add(new HelpSection("基本功能", basicContent));

            } else {
                // 快速开始 - 英文
                List<HelpStep> steps = new ArrayList<>();
                steps.add(new HelpStep(1, "Register Account", "Click the register button, fill in username, email and password to complete registration."));
                steps.add(new HelpStep(2, "Verify Email", "Check your email and click the verification link to activate your account."));
                steps.add(new HelpStep(3, "Login System", "Use the registered email and password to log in to the system."));
                steps.add(new HelpStep(4, "Upload Document", "Click the upload button on the document page, select PDF, Word or TXT files."));
                steps.add(new HelpStep(5, "Start Reading", "Open the document and start learning using the reader."));

                List<String> tips = new ArrayList<>();
                tips.add("It is recommended to use Chrome browser for the best experience");
                tips.add("Please check the help documentation when using it for the first time");
                tips.add("Multiple documents can be uploaded at the same time");
                tips.add("Supports PDF, Word, TXT and EPUB formats");

                HelpContent content = new HelpContent(
                        "Welcome to Vue Reading App! This guide will help you get started quickly with this application.",
                        steps,
                        tips
                );

                sections.add(new HelpSection("Quick Start", content));

                // 基本功能 - 英文
                List<HelpStep> basicSteps = new ArrayList<>();
                basicSteps.add(new HelpStep(1, "Document Management", "You can view, edit, and delete uploaded documents on the document page."));
                basicSteps.add(new HelpStep(2, "Vocabulary Learning", "Double-click a word while reading to view its definition and add it to your vocabulary list."));
                basicSteps.add(new HelpStep(3, "Note Function", "Select text to add highlights and notes."));
                basicSteps.add(new HelpStep(4, "Review System", "The system will automatically arrange review plans based on the memory curve."));

                List<String> basicTips = new ArrayList<>();
                basicTips.add("Regular review can improve memory effect");
                basicTips.add("Using tags can better organize documents");
                basicTips.add("Export function can back up learning data");

                HelpContent basicContent = new HelpContent(
                        "Understand the basic functions of the application to make learning more efficient.",
                        basicSteps,
                        basicTips
                );

                sections.add(new HelpSection("Basic Functions", basicContent));
            }

        } else if ("reading".equals(topic)) {
            if ("zh-CN".equals(language)) {
                // 阅读功能 - 中文
                List<HelpStep> steps = new ArrayList<>();
                steps.add(new HelpStep(1, "打开文档", "在文档列表点击文档标题打开阅读器。"));
                steps.add(new HelpStep(2, "调整设置", "点击设置按钮调整字体、主题、行距等阅读参数。"));
                steps.add(new HelpStep(3, "使用书签", "点击书签图标保存当前阅读位置。"));
                steps.add(new HelpStep(4, "搜索内容", "使用搜索功能快速定位文档内容。"));

                List<String> tips = new ArrayList<>();
                tips.add("双击单词可以查看释义");
                tips.add("选中文本可以添加高亮");
                tips.add("右键菜单提供更多操作");
                tips.add("支持夜间阅读模式");

                HelpContent content = new HelpContent(
                        "掌握阅读器的各项功能，提升阅读体验和学习效率。",
                        steps,
                        tips
                );

                sections.add(new HelpSection("阅读功能", content));

            } else {
                // 阅读功能 - 英文
                List<HelpStep> steps = new ArrayList<>();
                steps.add(new HelpStep(1, "Open Document", "Click the document title in the document list to open the reader."));
                steps.add(new HelpStep(2, "Adjust Settings", "Click the settings button to adjust reading parameters such as font, theme, line spacing, etc."));
                steps.add(new HelpStep(3, "Use Bookmarks", "Click the bookmark icon to save the current reading position."));
                steps.add(new HelpStep(4, "Search Content", "Use the search function to quickly locate document content."));

                List<String> tips = new ArrayList<>();
                tips.add("Double-click a word to view its definition");
                tips.add("Select text to add highlights");
                tips.add("Right-click menu provides more operations");
                tips.add("Supports night reading mode");

                HelpContent content = new HelpContent(
                        "Master the various functions of the reader to improve reading experience and learning efficiency.",
                        steps,
                        tips
                );

                sections.add(new HelpSection("Reading Functions", content));
            }

        } else if ("vocabulary".equals(topic)) {
            if ("zh-CN".equals(language)) {
                // 词汇管理 - 中文
                List<HelpStep> steps = new ArrayList<>();
                steps.add(new HelpStep(1, "添加单词", "阅读时双击单词，点击'添加到生词本'按钮。"));
                steps.add(new HelpStep(2, "查看生词本", "在词汇页面查看所有已添加的单词。"));
                steps.add(new HelpStep(3, "复习单词", "系统会根据记忆曲线自动安排复习。"));
                steps.add(new HelpStep(4, "导出词汇", "可以将生词本导出为Excel或CSV格式。"));

                List<String> tips = new ArrayList<>();
                tips.add("定期复习可以提高记忆效果");
                tips.add("使用标签可以分类管理单词");
                tips.add("可以查看单词的详细释义和例句");
                tips.add("支持批量导入和导出");

                HelpContent content = new HelpContent(
                        "学习如何管理您的词汇，建立个性化的单词学习系统。",
                        steps,
                        tips
                );

                sections.add(new HelpSection("词汇管理", content));

            } else {
                // 词汇管理 - 英文
                List<HelpStep> steps = new ArrayList<>();
                steps.add(new HelpStep(1, "Add Words", "Double-click a word while reading, click the 'Add to Vocabulary' button."));
                steps.add(new HelpStep(2, "View Vocabulary", "View all added words on the vocabulary page."));
                steps.add(new HelpStep(3, "Review Words", "The system will automatically arrange reviews based on the memory curve."));
                steps.add(new HelpStep(4, "Export Vocabulary", "You can export your vocabulary to Excel or CSV format."));

                List<String> tips = new ArrayList<>();
                tips.add("Regular review can improve memory effect");
                tips.add("Use tags to categorize and manage words");
                tips.add("You can view detailed definitions and examples of words");
                tips.add("Supports batch import and export");

                HelpContent content = new HelpContent(
                        "Learn how to manage your vocabulary and build a personalized word learning system.",
                        steps,
                        tips
                );

                sections.add(new HelpSection("Vocabulary Management", content));
            }

        } else {
            // 默认主题 - 常见问题
            if ("zh-CN".equals(language)) {
                List<HelpStep> steps = new ArrayList<>();
                steps.add(new HelpStep(1, "如何找回密码", "在登录页面点击'忘记密码'，按照提示重置密码。"));
                steps.add(new HelpStep(2, "如何联系客服", "在设置页面找到'联系我们'，发送邮件或留言。"));
                steps.add(new HelpStep(3, "如何导出数据", "在导出页面选择要导出的数据类型和格式。"));
                steps.add(new HelpStep(4, "如何设置提醒", "在设置页面找到'通知设置'，开启复习提醒。"));

                List<String> tips = new ArrayList<>();
                tips.add("常见问题可以在FAQ页面找到答案");
                tips.add("可以通过反馈功能提交问题");
                tips.add("系统会定期更新帮助文档");

                HelpContent content = new HelpContent(
                        "这里是一些常见问题的解答，帮助您更好地使用本应用。",
                        steps,
                        tips
                );

                sections.add(new HelpSection("常见问题", content));

            } else {
                List<HelpStep> steps = new ArrayList<>();
                steps.add(new HelpStep(1, "How to Reset Password", "Click 'Forgot Password' on the login page and follow the prompts to reset your password."));
                steps.add(new HelpStep(2, "How to Contact Customer Service", "Find 'Contact Us' on the settings page, send an email or leave a message."));
                steps.add(new HelpStep(3, "How to Export Data", "Select the data type and format to export on the export page."));
                steps.add(new HelpStep(4, "How to Set Reminders", "Find 'Notification Settings' on the settings page and turn on review reminders."));

                List<String> tips = new ArrayList<>();
                tips.add("Common questions can be found in the FAQ page");
                tips.add("You can submit questions through the feedback function");
                tips.add("The system will regularly update help documentation");

                HelpContent content = new HelpContent(
                        "Here are answers to some frequently asked questions to help you use this application better.",
                        steps,
                        tips
                );

                sections.add(new HelpSection("Frequently Asked Questions", content));
            }
        }

        return sections;
    }
}

--- 结束文件: SystemGetHelpDocumentation.java ---

--- 开始文件: SystemGetPrivacyPolicy.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetPrivacyPolicy {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取隐私政策请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("=========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class PrivacyRequest {
        private String language;
        private String version;

        public String getLanguage() { return language != null ? language : "zh-CN"; }
        public void setLanguage(String language) { this.language = language; }

        public String getVersion() { return version != null ? version : "1.0"; }
        public void setVersion(String version) { this.version = version; }
    }

    // 响应DTO
    public static class PrivacyResponse {
        private boolean success;
        private String message;
        private PrivacyData data;

        public PrivacyResponse(boolean success, String message, PrivacyData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public PrivacyData getData() { return data; }
        public void setData(PrivacyData data) { this.data = data; }
    }

    public static class PrivacyData {
        private String title;
        private String version;
        private String language;
        private String effectiveDate;
        private List<PrivacySection> sections;
        private ContactInfo contact;

        public PrivacyData(String title, String version, String language, String effectiveDate,
                           List<PrivacySection> sections, ContactInfo contact) {
            this.title = title;
            this.version = version;
            this.language = language;
            this.effectiveDate = effectiveDate;
            this.sections = sections;
            this.contact = contact;
        }

        public String getTitle() { return title; }
        public void setTitle(String title) { this.title = title; }

        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }

        public String getLanguage() { return language; }
        public void setLanguage(String language) { this.language = language; }

        public String getEffectiveDate() { return effectiveDate; }
        public void setEffectiveDate(String effectiveDate) { this.effectiveDate = effectiveDate; }

        public List<PrivacySection> getSections() { return sections; }
        public void setSections(List<PrivacySection> sections) { this.sections = sections; }

        public ContactInfo getContact() { return contact; }
        public void setContact(ContactInfo contact) { this.contact = contact; }
    }

    public static class PrivacySection {
        private String title;
        private String content;

        public PrivacySection(String title, String content) {
            this.title = title;
            this.content = content;
        }

        public String getTitle() { return title; }
        public void setTitle(String title) { this.title = title; }

        public String getContent() { return content; }
        public void setContent(String content) { this.content = content; }
    }

    public static class ContactInfo {
        private String email;
        private String address;

        public ContactInfo(String email, String address) {
            this.email = email;
            this.address = address;
        }

        public String getEmail() { return email; }
        public void setEmail(String email) { this.email = email; }

        public String getAddress() { return address; }
        public void setAddress(String address) { this.address = address; }
    }

    @GetMapping("/privacy")
    public ResponseEntity<PrivacyResponse> getPrivacyPolicy(@RequestParam(required = false) String language,
                                                            @RequestParam(required = false) String version) {

        // 创建请求对象
        PrivacyRequest request = new PrivacyRequest();
        request.setLanguage(language);
        request.setVersion(version);

        // 打印接收到的请求
        printRequest(request);

        try {
            // 1. 根据语言和版本构建隐私政策
            List<PrivacySection> sections = buildPrivacySections(request.getLanguage());
            ContactInfo contactInfo = buildContactInfo(request.getLanguage());

            // 2. 构建响应数据
            PrivacyData privacyData = new PrivacyData(
                    "隐私政策",
                    request.getVersion(),
                    request.getLanguage(),
                    LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME),
                    sections,
                    contactInfo
            );

            PrivacyResponse response = new PrivacyResponse(true, "获取隐私政策成功", privacyData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取隐私政策过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new PrivacyResponse(false, "获取隐私政策失败: " + e.getMessage(), null)
            );
        }
    }

    // 构建隐私政策章节
    private List<PrivacySection> buildPrivacySections(String language) {
        List<PrivacySection> sections = new ArrayList<>();

        if ("zh-CN".equals(language)) {
            sections.add(new PrivacySection("信息收集",
                    "我们收集以下类型的信息：\n" +
                            "1. 账户信息：当您注册账户时，我们会收集您的用户名、邮箱地址、密码等信息。\n" +
                            "2. 使用数据：我们会收集您使用本应用的相关信息，包括但不限于您上传的文档、添加的词汇、阅读记录、学习进度等。\n" +
                            "3. 设备信息：为了提供更好的服务，我们会收集您的设备信息，包括设备型号、操作系统版本、浏览器类型等。\n" +
                            "4. 日志信息：当您使用本应用时，我们会自动收集某些日志信息，包括IP地址、访问时间、页面浏览记录等。"));

            sections.add(new PrivacySection("信息使用",
                    "我们使用收集的信息用于以下目的：\n" +
                            "1. 提供和维护服务：使用您的信息来提供、维护和改进本应用的功能和服务。\n" +
                            "2. 个性化体验：根据您的使用习惯和偏好，为您提供个性化的学习内容和推荐。\n" +
                            "3. 沟通与支持：使用您的联系信息与您沟通，回复您的咨询，提供技术支持。\n" +
                            "4. 安全与合规：检测和防止欺诈、滥用和安全问题，遵守法律法规要求。\n" +
                            "5. 分析与研究：分析使用模式，进行产品研究和开发，以改进用户体验。"));

            sections.add(new PrivacySection("信息共享",
                    "我们不会出售或出租您的个人信息给第三方。我们仅在以下情况下共享您的信息：\n" +
                            "1. 征得您的同意：在获得您的明确同意后，我们会与其他方共享您的信息。\n" +
                            "2. 法律要求：为遵守适用的法律法规、法律程序或政府要求，我们可能会披露您的信息。\n" +
                            "3. 保护权利：为保护我们、我们的用户或公众的权利、财产或安全，我们可能会披露信息。\n" +
                            "4. 服务提供商：我们可能会与为我们提供服务的第三方共享必要的信息，但这些服务提供商必须遵守严格的保密义务。"));

            sections.add(new PrivacySection("数据安全",
                    "我们采取合理的技术和组织措施来保护您的个人信息安全：\n" +
                            "1. 加密技术：对敏感信息进行加密存储和传输。\n" +
                            "2. 访问控制：限制对个人信息的访问权限，仅允许有必要知晓的员工访问。\n" +
                            "3. 安全审计：定期进行安全审计和漏洞扫描，及时修复安全问题。\n" +
                            "4. 员工培训：对员工进行隐私保护培训，确保他们了解并遵守隐私政策。\n" +
                            "然而，请注意没有任何安全措施是绝对可靠的，我们无法保证信息的绝对安全。"));

            sections.add(new PrivacySection("您的权利",
                    "您对自己的个人信息享有以下权利：\n" +
                            "1. 访问权：您有权访问我们持有的关于您的个人信息。\n" +
                            "2. 更正权：您有权要求更正不准确或不完整的个人信息。\n" +
                            "3. 删除权：在某些情况下，您有权要求删除您的个人信息。\n" +
                            "4. 限制处理权：您有权限制我们对您个人信息的使用。\n" +
                            "5. 数据可携权：您有权以结构化、常用和机器可读的格式获取您的个人信息。\n" +
                            "6. 反对权：您有权反对基于特定目的处理您的个人信息。\n" +
                            "如需行使上述权利，请通过隐私政策中提供的联系方式与我们联系。"));

            sections.add(new PrivacySection("数据保留",
                    "我们仅在实现本隐私政策所述目的所需的时间内保留您的个人信息，除非法律要求或允许更长的保留期。\n" +
                            "具体的保留期限取决于信息的类型、收集目的以及法律要求。\n" +
                            "当不再需要您的个人信息时，我们会采取安全的方式将其删除或匿名化处理。"));

            sections.add(new PrivacySection("儿童隐私",
                    "我们的服务不面向13岁以下的儿童。我们不会故意收集13岁以下儿童的个人信息。\n" +
                            "如果您是父母或监护人，并且认为您的孩子向我们提供了个人信息，请与我们联系，我们将采取措施删除这些信息。"));

            sections.add(new PrivacySection("政策更新",
                    "我们可能会不时更新本隐私政策。如有重大变更，我们会在本应用内发布通知，并更新政策顶部的生效日期。\n" +
                            "我们建议您定期查看本隐私政策以了解任何变更。继续使用我们的服务即表示您接受更新后的隐私政策。"));

        } else {
            // 默认英文版本
            sections.add(new PrivacySection("Information Collection",
                    "We collect the following types of information:\n" +
                            "1. Account Information: When you register an account, we collect your username, email address, password, etc.\n" +
                            "2. Usage Data: We collect information related to your use of the App, including but not limited to documents you upload, vocabulary you add, reading records, learning progress, etc.\n" +
                            "3. Device Information: To provide better services, we collect your device information, including device model, operating system version, browser type, etc.\n" +
                            "4. Log Information: When you use the App, we automatically collect certain log information, including IP address, access time, page view records, etc."));

            sections.add(new PrivacySection("Information Use",
                    "We use the collected information for the following purposes:\n" +
                            "1. Provide and Maintain Services: Use your information to provide, maintain, and improve the functions and services of the App.\n" +
                            "2. Personalized Experience: Provide you with personalized learning content and recommendations based on your usage habits and preferences.\n" +
                            "3. Communication and Support: Use your contact information to communicate with you, respond to your inquiries, and provide technical support.\n" +
                            "4. Security and Compliance: Detect and prevent fraud, abuse, and security issues, and comply with legal and regulatory requirements.\n" +
                            "5. Analysis and Research: Analyze usage patterns, conduct product research and development to improve user experience."));

            sections.add(new PrivacySection("Information Sharing",
                    "We do not sell or rent your personal information to third parties. We only share your information in the following circumstances:\n" +
                            "1. With Your Consent: We will share your information with other parties after obtaining your explicit consent.\n" +
                            "2. Legal Requirements: To comply with applicable laws, regulations, legal procedures, or government requirements, we may disclose your information.\n" +
                            "3. Protection of Rights: To protect the rights, property, or safety of us, our users, or the public, we may disclose information.\n" +
                            "4. Service Providers: We may share necessary information with third parties who provide services to us, but these service providers must comply with strict confidentiality obligations."));

            sections.add(new PrivacySection("Data Security",
                    "We take reasonable technical and organizational measures to protect the security of your personal information:\n" +
                            "1. Encryption Technology: Encrypt sensitive information for storage and transmission.\n" +
                            "2. Access Control: Restrict access to personal information, allowing only employees who need to know to access it.\n" +
                            "3. Security Audits: Regularly conduct security audits and vulnerability scans, and promptly fix security issues.\n" +
                            "4. Employee Training: Provide privacy protection training to employees to ensure they understand and comply with the privacy policy.\n" +
                            "However, please note that no security measures are absolutely reliable, and we cannot guarantee absolute security of information."));

            sections.add(new PrivacySection("Your Rights",
                    "You have the following rights regarding your personal information:\n" +
                            "1. Right of Access: You have the right to access the personal information we hold about you.\n" +
                            "2. Right to Rectification: You have the right to request correction of inaccurate or incomplete personal information.\n" +
                            "3. Right to Erasure: In certain circumstances, you have the right to request deletion of your personal information.\n" +
                            "4. Right to Restriction of Processing: You have the right to restrict our use of your personal information.\n" +
                            "5. Right to Data Portability: You have the right to obtain your personal information in a structured, commonly used, and machine-readable format.\n" +
                            "6. Right to Object: You have the right to object to the processing of your personal information for specific purposes.\n" +
                            "To exercise the above rights, please contact us using the contact information provided in the privacy policy."));

            sections.add(new PrivacySection("Data Retention",
                    "We retain your personal information only for as long as necessary to achieve the purposes described in this privacy policy, unless the law requires or permits a longer retention period.\n" +
                            "The specific retention period depends on the type of information, the purpose of collection, and legal requirements.\n" +
                            "When your personal information is no longer needed, we will delete or anonymize it in a secure manner."));

            sections.add(new PrivacySection("Children's Privacy",
                    "Our services are not directed to children under 13 years of age. We do not knowingly collect personal information from children under 13.\n" +
                            "If you are a parent or guardian and believe that your child has provided us with personal information, please contact us, and we will take steps to delete such information."));

            sections.add(new PrivacySection("Policy Updates",
                    "We may update this privacy policy from time to time. If there are significant changes, we will post a notice in the App and update the effective date at the top of the policy.\n" +
                            "We recommend that you regularly review this privacy policy to be aware of any changes. Continued use of our services indicates your acceptance of the updated privacy policy."));
        }

        return sections;
    }

    // 构建联系信息
    private ContactInfo buildContactInfo(String language) {
        if ("zh-CN".equals(language)) {
            return new ContactInfo(
                    "privacy@vuereadingapp.com",
                    "北京市朝阳区某某路123号"
            );
        } else {
            return new ContactInfo(
                    "privacy@vuereadingapp.com",
                    "123 Some Road, Chaoyang District, Beijing, China"
            );
        }
    }
}

--- 结束文件: SystemGetPrivacyPolicy.java ---

--- 开始文件: SystemGetResources.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.lang.management.ManagementFactory;
import java.lang.management.OperatingSystemMXBean;
import java.lang.management.RuntimeMXBean;
import java.lang.management.MemoryMXBean;
import java.lang.management.MemoryUsage;
import java.time.LocalDateTime;
import java.util.Map;
import java.util.HashMap;
import java.util.List;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetResources {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取系统资源请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("=========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 响应DTO
    public static class ResourcesResponse {
        private boolean success;
        private String message;
        private ResourcesData data;

        public ResourcesResponse(boolean success, String message, ResourcesData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public ResourcesData getData() { return data; }
        public void setData(ResourcesData data) { this.data = data; }
    }

    public static class ResourcesData {
        private CpuInfo cpu;
        private MemoryInfo memory;
        private DiskInfo disk;
        private NetworkInfo network;
        private DatabaseInfo database;

        public ResourcesData(CpuInfo cpu, MemoryInfo memory, DiskInfo disk,
                             NetworkInfo network, DatabaseInfo database) {
            this.cpu = cpu;
            this.memory = memory;
            this.disk = disk;
            this.network = network;
            this.database = database;
        }

        public CpuInfo getCpu() { return cpu; }
        public void setCpu(CpuInfo cpu) { this.cpu = cpu; }

        public MemoryInfo getMemory() { return memory; }
        public void setMemory(MemoryInfo memory) { this.memory = memory; }

        public DiskInfo getDisk() { return disk; }
        public void setDisk(DiskInfo disk) { this.disk = disk; }

        public NetworkInfo getNetwork() { return network; }
        public void setNetwork(NetworkInfo network) { this.network = network; }

        public DatabaseInfo getDatabase() { return database; }
        public void setDatabase(DatabaseInfo database) { this.database = database; }
    }

    public static class CpuInfo {
        private double usage;
        private int cores;
        private double[] loadAverage;

        public CpuInfo(double usage, int cores, double[] loadAverage) {
            this.usage = usage;
            this.cores = cores;
            this.loadAverage = loadAverage;
        }

        public double getUsage() { return usage; }
        public void setUsage(double usage) { this.usage = usage; }

        public int getCores() { return cores; }
        public void setCores(int cores) { this.cores = cores; }

        public double[] getLoadAverage() { return loadAverage; }
        public void setLoadAverage(double[] loadAverage) { this.loadAverage = loadAverage; }
    }

    public static class MemoryInfo {
        private long total;
        private long used;
        private long free;
        private double usagePercentage;

        public MemoryInfo(long total, long used, long free, double usagePercentage) {
            this.total = total;
            this.used = used;
            this.free = free;
            this.usagePercentage = usagePercentage;
        }

        public long getTotal() { return total; }
        public void setTotal(long total) { this.total = total; }

        public long getUsed() { return used; }
        public void setUsed(long used) { this.used = used; }

        public long getFree() { return free; }
        public void setFree(long free) { this.free = free; }

        public double getUsagePercentage() { return usagePercentage; }
        public void setUsagePercentage(double usagePercentage) { this.usagePercentage = usagePercentage; }
    }

    public static class DiskInfo {
        private long total;
        private long used;
        private long free;
        private double usagePercentage;

        public DiskInfo(long total, long used, long free, double usagePercentage) {
            this.total = total;
            this.used = used;
            this.free = free;
            this.usagePercentage = usagePercentage;
        }

        public long getTotal() { return total; }
        public void setTotal(long total) { this.total = total; }

        public long getUsed() { return used; }
        public void setUsed(long used) { this.used = used; }

        public long getFree() { return free; }
        public void setFree(long free) { this.free = free; }

        public double getUsagePercentage() { return usagePercentage; }
        public void setUsagePercentage(double usagePercentage) { this.usagePercentage = usagePercentage; }
    }

    public static class NetworkInfo {
        private long inbound;
        private long outbound;
        private int connections;

        public NetworkInfo(long inbound, long outbound, int connections) {
            this.inbound = inbound;
            this.outbound = outbound;
            this.connections = connections;
        }

        public long getInbound() { return inbound; }
        public void setInbound(long inbound) { this.inbound = inbound; }

        public long getOutbound() { return outbound; }
        public void setOutbound(long outbound) { this.outbound = outbound; }

        public int getConnections() { return connections; }
        public void setConnections(int connections) { this.connections = connections; }
    }

    public static class DatabaseInfo {
        private int connections;
        private int maxConnections;
        private QueryTime queryTime;

        public DatabaseInfo(int connections, int maxConnections, QueryTime queryTime) {
            this.connections = connections;
            this.maxConnections = maxConnections;
            this.queryTime = queryTime;
        }

        public int getConnections() { return connections; }
        public void setConnections(int connections) { this.connections = connections; }

        public int getMaxConnections() { return maxConnections; }
        public void setMaxConnections(int maxConnections) { this.maxConnections = maxConnections; }

        public QueryTime getQueryTime() { return queryTime; }
        public void setQueryTime(QueryTime queryTime) { this.queryTime = queryTime; }
    }

    public static class QueryTime {
        private double average;
        private double max;

        public QueryTime(double average, double max) {
            this.average = average;
            this.max = max;
        }

        public double getAverage() { return average; }
        public void setAverage(double average) { this.average = average; }

        public double getMax() { return max; }
        public void setMax(double max) { this.max = max; }
    }

    @GetMapping("/resources")
    public ResponseEntity<ResourcesResponse> getResources() {
        // 打印接收到的请求
        printRequest("GET /api/system/resources");

        try {
            // 1. 获取系统信息
            OperatingSystemMXBean osBean = ManagementFactory.getOperatingSystemMXBean();
            RuntimeMXBean runtimeBean = ManagementFactory.getRuntimeMXBean();
            MemoryMXBean memoryBean = ManagementFactory.getMemoryMXBean();

            // 2. 构建CPU信息
            int availableProcessors = osBean.getAvailableProcessors();
            double systemLoadAverage = osBean.getSystemLoadAverage();
            double cpuUsage = Math.min(100.0, Math.max(0.0, (systemLoadAverage / availableProcessors) * 100));

            double[] loadAverage = new double[3];
            loadAverage[0] = systemLoadAverage;
            loadAverage[1] = systemLoadAverage * 0.8; // 模拟1分钟平均负载
            loadAverage[2] = systemLoadAverage * 0.6; // 模拟15分钟平均负载

            CpuInfo cpuInfo = new CpuInfo(
                    Math.round(cpuUsage * 10.0) / 10.0,
                    availableProcessors,
                    loadAverage
            );

            // 3. 构建内存信息
            MemoryUsage heapMemoryUsage = memoryBean.getHeapMemoryUsage();
            MemoryUsage nonHeapMemoryUsage = memoryBean.getNonHeapMemoryUsage();

            long totalMemory = heapMemoryUsage.getCommitted() + nonHeapMemoryUsage.getCommitted();
            long usedMemory = heapMemoryUsage.getUsed() + nonHeapMemoryUsage.getUsed();
            long freeMemory = totalMemory - usedMemory;
            double memoryUsagePercentage = totalMemory > 0 ? ((double) usedMemory / totalMemory) * 100 : 0;

            MemoryInfo memoryInfo = new MemoryInfo(
                    totalMemory,
                    usedMemory,
                    freeMemory,
                    Math.round(memoryUsagePercentage * 10.0) / 10.0
            );

            // 4. 构建磁盘信息（模拟数据）
            long totalDisk = 107374182400L; // 100GB
            long usedDisk = 53687091200L;   // 50GB
            long freeDisk = totalDisk - usedDisk;
            double diskUsagePercentage = ((double) usedDisk / totalDisk) * 100;

            DiskInfo diskInfo = new DiskInfo(
                    totalDisk,
                    usedDisk,
                    freeDisk,
                    Math.round(diskUsagePercentage * 10.0) / 10.0
            );

            // 5. 构建网络信息（模拟数据）
            long inbound = 1024000L;  // 1MB/s
            long outbound = 512000L;   // 500KB/s
            int connections = 150;

            NetworkInfo networkInfo = new NetworkInfo(inbound, outbound, connections);

            // 6. 构建数据库信息
            int dbConnections = 25;
            int maxConnections = 100;
            double avgQueryTime = 120.0;
            double maxQueryTime = 500.0;

            // 尝试查询数据库连接数（MySQL语法）
            try {
                List<Map<String, Object>> dbStats = jdbcTemplate.queryForList(
                        "SHOW STATUS WHERE variable_name = 'Threads_connected'"
                );
                if (!dbStats.isEmpty()) {
                    String threadsConnected = dbStats.get(0).get("Value").toString();
                    dbConnections = Integer.parseInt(threadsConnected);
                }
            } catch (Exception e) {
                System.out.println("无法获取数据库连接数: " + e.getMessage());
            }

            QueryTime queryTime = new QueryTime(avgQueryTime, maxQueryTime);
            DatabaseInfo databaseInfo = new DatabaseInfo(dbConnections, maxConnections, queryTime);

            // 7. 构建响应数据
            ResourcesData resourcesData = new ResourcesData(
                    cpuInfo,
                    memoryInfo,
                    diskInfo,
                    networkInfo,
                    databaseInfo
            );

            ResourcesResponse response = new ResourcesResponse(true, "获取系统资源成功", resourcesData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取系统资源过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            // 返回错误数据
            CpuInfo errorCpu = new CpuInfo(0.0, 0, new double[]{0, 0, 0});
            MemoryInfo errorMemory = new MemoryInfo(0, 0, 0, 0.0);
            DiskInfo errorDisk = new DiskInfo(0, 0, 0, 0.0);
            NetworkInfo errorNetwork = new NetworkInfo(0, 0, 0);
            QueryTime errorQueryTime = new QueryTime(0.0, 0.0);
            DatabaseInfo errorDatabase = new DatabaseInfo(0, 0, errorQueryTime);

            ResourcesData errorData = new ResourcesData(
                    errorCpu,
                    errorMemory,
                    errorDisk,
                    errorNetwork,
                    errorDatabase
            );

            ResourcesResponse errorResponse = new ResourcesResponse(false, "获取系统资源失败: " + e.getMessage(), errorData);
            printResponse(errorResponse);

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }
}

--- 结束文件: SystemGetResources.java ---

--- 开始文件: SystemGetServerTime.java ---

package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.ZoneId;
import java.time.ZonedDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetServerTime {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取服务器时间请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("=========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 响应DTO
    public static class TimeResponse {
        private boolean success;
        private String message;
        private TimeData data;

        public TimeResponse(boolean success, String message, TimeData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public TimeData getData() { return data; }
        public void setData(TimeData data) { this.data = data; }
    }

    public static class TimeData {
        private String serverTime;
        private String clientTime;
        private long timeDifference;
        private String timezone;
        private String formattedTime;

        public TimeData(String serverTime, String clientTime, long timeDifference,
                        String timezone, String formattedTime) {
            this.serverTime = serverTime;
            this.clientTime = clientTime;
            this.timeDifference = timeDifference;
            this.timezone = timezone;
            this.formattedTime = formattedTime;
        }

        public String getServerTime() { return serverTime; }
        public void setServerTime(String serverTime) { this.serverTime = serverTime; }

        public String getClientTime() { return clientTime; }
        public void setClientTime(String clientTime) { this.clientTime = clientTime; }

        public long getTimeDifference() { return timeDifference; }
        public void setTimeDifference(long timeDifference) { this.timeDifference = timeDifference; }

        public String getTimezone() { return timezone; }
        public void setTimezone(String timezone) { this.timezone = timezone; }

        public String getFormattedTime() { return formattedTime; }
        public void setFormattedTime(String formattedTime) { this.formattedTime = formattedTime; }
    }

    @GetMapping("/time")
    public ResponseEntity<TimeResponse> getServerTime(@RequestHeader(value = "X-Client-Time", required = false) String clientTimeHeader) {
        // 打印接收到的请求
        Map<String, Object> requestInfo = new HashMap<>();
        requestInfo.put("endpoint", "GET /api/system/time");
        requestInfo.put("clientTimeHeader", clientTimeHeader);
        printRequest(requestInfo);

        try {
            // 1. 获取服务器当前时间
            LocalDateTime serverNow = LocalDateTime.now();
            ZonedDateTime serverZoned = serverNow.atZone(ZoneId.systemDefault());

            // 2. 解析客户端时间（如果有）
            LocalDateTime clientTime = null;
            long timeDifference = 0;

            if (clientTimeHeader != null && !clientTimeHeader.trim().isEmpty()) {
                try {
                    // 尝试解析客户端时间戳
                    long clientTimestamp = Long.parseLong(clientTimeHeader);
                    clientTime = LocalDateTime.ofEpochSecond(clientTimestamp / 1000, 0, ZoneId.systemDefault().getRules().getOffset(serverNow));

                    // 计算时间差（毫秒）
                    long serverTimestamp = serverZoned.toInstant().toEpochMilli();
                    timeDifference = serverTimestamp - clientTimestamp;
                } catch (NumberFormatException e) {
                    System.out.println("客户端时间头格式错误: " + clientTimeHeader);
                }
            }

            // 3. 获取时区信息
            String timezone = ZoneId.systemDefault().getId();

            // 4. 格式化时间
            DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy年MM月dd日 HH:mm:ss");
            String formattedTime = serverNow.format(formatter);

            // 5. 构建响应数据
            TimeData timeData = new TimeData(
                    serverZoned.format(DateTimeFormatter.ISO_DATE_TIME),
                    clientTime != null ? clientTime.atZone(ZoneId.systemDefault()).format(DateTimeFormatter.ISO_DATE_TIME) : "unknown",
                    timeDifference,
                    timezone,
                    formattedTime
            );

            TimeResponse response = new TimeResponse(true, "获取服务器时间成功", timeData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取服务器时间过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            // 返回错误时间数据
            LocalDateTime errorTime = LocalDateTime.now();
            ZonedDateTime errorZoned = errorTime.atZone(ZoneId.systemDefault());

            TimeData errorData = new TimeData(
                    errorZoned.format(DateTimeFormatter.ISO_DATE_TIME),
                    "error",
                    0,
                    "error",
                    "时间获取失败"
            );

            TimeResponse errorResponse = new TimeResponse(false, "获取服务器时间失败: " + e.getMessage(), errorData);
            printResponse(errorResponse);

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }
}
--- 结束文件: SystemGetServerTime.java ---

--- 开始文件: SystemGetStatistics.java ---

package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetStatistics {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取系统统计信息请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("============================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class StatisticsRequest {
        private String period;
        private List<String> metrics;

        public String getPeriod() { return period != null ? period : "7d"; }
        public void setPeriod(String period) { this.period = period; }

        public List<String> getMetrics() {
            if (metrics == null || metrics.isEmpty()) {
                return new ArrayList<>(java.util.Arrays.asList("users", "documents", "vocabulary", "reviews"));
            }
            return metrics;
        }
        public void setMetrics(List<String> metrics) { this.metrics = metrics; }
    }

    // 响应DTO
    public static class StatisticsResponse {
        private boolean success;
        private String message;
        private StatisticsData data;

        public StatisticsResponse(boolean success, String message, StatisticsData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public StatisticsData getData() { return data; }
        public void setData(StatisticsData data) { this.data = data; }
    }

    public static class StatisticsData {
        private String period;
        private MetricsInfo metrics;
        private Map<String, List<Integer>> trends;

        public StatisticsData(String period, MetricsInfo metrics, Map<String, List<Integer>> trends) {
            this.period = period;
            this.metrics = metrics;
            this.trends = trends;
        }

        public String getPeriod() { return period; }
        public void setPeriod(String period) { this.period = period; }

        public MetricsInfo getMetrics() { return metrics; }
        public void setMetrics(MetricsInfo metrics) { this.metrics = metrics; }

        public Map<String, List<Integer>> getTrends() { return trends; }
        public void setTrends(Map<String, List<Integer>> trends) { this.trends = trends; }
    }

    public static class MetricsInfo {
        private UserMetrics users;
        private DocumentMetrics documents;
        private VocabularyMetrics vocabulary;
        private ReviewMetrics reviews;

        public MetricsInfo(UserMetrics users, DocumentMetrics documents,
                           VocabularyMetrics vocabulary, ReviewMetrics reviews) {
            this.users = users;
            this.documents = documents;
            this.vocabulary = vocabulary;
            this.reviews = reviews;
        }

        public UserMetrics getUsers() { return users; }
        public void setUsers(UserMetrics users) { this.users = users; }

        public DocumentMetrics getDocuments() { return documents; }
        public void setDocuments(DocumentMetrics documents) { this.documents = documents; }

        public VocabularyMetrics getVocabulary() { return vocabulary; }
        public void setVocabulary(VocabularyMetrics vocabulary) { this.vocabulary = vocabulary; }

        public ReviewMetrics getReviews() { return reviews; }
        public void setReviews(ReviewMetrics reviews) { this.reviews = reviews; }
    }

    public static class UserMetrics {
        private int total;
        private int active;
        private int newUsers;
        private double growth;

        public UserMetrics(int total, int active, int newUsers, double growth) {
            this.total = total;
            this.active = active;
            this.newUsers = newUsers;
            this.growth = growth;
        }

        public int getTotal() { return total; }
        public void setTotal(int total) { this.total = total; }

        public int getActive() { return active; }
        public void setActive(int active) { this.active = active; }

        public int getNewUsers() { return newUsers; }
        public void setNewUsers(int newUsers) { this.newUsers = newUsers; }

        public double getGrowth() { return growth; }
        public void setGrowth(double growth) { this.growth = growth; }
    }

    public static class DocumentMetrics {
        private int total;
        private int uploaded;
        private int processed;
        private int failed;

        public DocumentMetrics(int total, int uploaded, int processed, int failed) {
            this.total = total;
            this.uploaded = uploaded;
            this.processed = processed;
            this.failed = failed;
        }

        public int getTotal() { return total; }
        public void setTotal(int total) { this.total = total; }

        public int getUploaded() { return uploaded; }
        public void setUploaded(int uploaded) { this.uploaded = uploaded; }

        public int getProcessed() { return processed; }
        public void setProcessed(int processed) { this.processed = processed; }

        public int getFailed() { return failed; }
        public void setFailed(int failed) { this.failed = failed; }
    }

    public static class VocabularyMetrics {
        private int total;
        private int added;
        private int reviewed;
        private int mastered;

        public VocabularyMetrics(int total, int added, int reviewed, int mastered) {
            this.total = total;
            this.added = added;
            this.reviewed = reviewed;
            this.mastered = mastered;
        }

        public int getTotal() { return total; }
        public void setTotal(int total) { this.total = total; }

        public int getAdded() { return added; }
        public void setAdded(int added) { this.added = added; }

        public int getReviewed() { return reviewed; }
        public void setReviewed(int reviewed) { this.reviewed = reviewed; }

        public int getMastered() { return mastered; }
        public void setMastered(int mastered) { this.mastered = mastered; }
    }

    public static class ReviewMetrics {
        private int total;
        private int completed;
        private double accuracy;
        private int averageTime;

        public ReviewMetrics(int total, int completed, double accuracy, int averageTime) {
            this.total = total;
            this.completed = completed;
            this.accuracy = accuracy;
            this.averageTime = averageTime;
        }

        public int getTotal() { return total; }
        public void setTotal(int total) { this.total = total; }

        public int getCompleted() { return completed; }
        public void setCompleted(int completed) { this.completed = completed; }

        public double getAccuracy() { return accuracy; }
        public void setAccuracy(double accuracy) { this.accuracy = accuracy; }

        public int getAverageTime() { return averageTime; }
        public void setAverageTime(int averageTime) { this.averageTime = averageTime; }
    }

    @GetMapping("/statistics")
    public ResponseEntity<StatisticsResponse> getStatistics(@RequestParam(required = false) String period,
                                                            @RequestParam(required = false) List<String> metrics) {

        // 创建请求对象
        StatisticsRequest request = new StatisticsRequest();
        request.setPeriod(period);
        request.setMetrics(metrics);

        // 打印接收到的请求
        printRequest(request);

        try {
            // 1. 查询用户统计
            int totalUsers = 0;
            int activeUsers = 0;
            int newUsers = 0;

            try {
                // 查询总用户数
                String totalUsersSql = "SELECT COUNT(*) FROM users";
                totalUsers = jdbcTemplate.queryForObject(totalUsersSql, Integer.class);

                // 查询活跃用户数（最近7天有活动的用户）
                String activeUsersSql = "SELECT COUNT(DISTINCT user_id) FROM reading_history WHERE start_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)";
                activeUsers = jdbcTemplate.queryForObject(activeUsersSql, Integer.class);

                // 查询新用户数（最近7天注册的用户）
                String newUsersSql = "SELECT COUNT(*) FROM users WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)";
                newUsers = jdbcTemplate.queryForObject(newUsersSql, Integer.class);
            } catch (Exception e) {
                System.out.println("查询用户统计时发生错误: " + e.getMessage());
            }

            // 2. 查询文档统计
            int totalDocuments = 0;
            int uploadedDocuments = 0;
            int processedDocuments = 0;
            int failedDocuments = 0;

            try {
                // 查询总文档数
                String totalDocsSql = "SELECT COUNT(*) FROM documents";
                totalDocuments = jdbcTemplate.queryForObject(totalDocsSql, Integer.class);

                // 查询已上传文档数
                String uploadedDocsSql = "SELECT COUNT(*) FROM documents WHERE status = 'uploaded'";
                uploadedDocuments = jdbcTemplate.queryForObject(uploadedDocsSql, Integer.class);

                // 查询已处理文档数
                String processedDocsSql = "SELECT COUNT(*) FROM documents WHERE status = 'processed'";
                processedDocuments = jdbcTemplate.queryForObject(processedDocsSql, Integer.class);

                // 查询失败文档数
                String failedDocsSql = "SELECT COUNT(*) FROM documents WHERE status = 'failed'";
                failedDocuments = jdbcTemplate.queryForObject(failedDocsSql, Integer.class);
            } catch (Exception e) {
                System.out.println("查询文档统计时发生错误: " + e.getMessage());
            }

            // 3. 查询词汇统计
            int totalVocabulary = 0;
            int addedVocabulary = 0;
            int reviewedVocabulary = 0;
            int masteredVocabulary = 0;

            try {
                // 查询总词汇数
                String totalVocabSql = "SELECT COUNT(*) FROM user_vocabulary";
                totalVocabulary = jdbcTemplate.queryForObject(totalVocabSql, Integer.class);

                // 查询最近7天添加的词汇数
                String addedVocabSql = "SELECT COUNT(*) FROM user_vocabulary WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)";
                addedVocabulary = jdbcTemplate.queryForObject(addedVocabSql, Integer.class);

                // 查询已复习词汇数
                String reviewedVocabSql = "SELECT COUNT(*) FROM user_vocabulary WHERE review_count > 0";
                reviewedVocabulary = jdbcTemplate.queryForObject(reviewedVocabSql, Integer.class);

                // 查询已掌握词汇数
                String masteredVocabSql = "SELECT COUNT(*) FROM user_vocabulary WHERE mastery_level >= 0.8";
                masteredVocabulary = jdbcTemplate.queryForObject(masteredVocabSql, Integer.class);
            } catch (Exception e) {
                System.out.println("查询词汇统计时发生错误: " + e.getMessage());
            }

            // 4. 查询复习统计
            int totalReviews = 0;
            int completedReviews = 0;
            double reviewAccuracy = 0.0;
            int averageReviewTime = 0;

            try {
                // 查询总复习次数
                String totalReviewsSql = "SELECT COUNT(*) FROM review_items";
                totalReviews = jdbcTemplate.queryForObject(totalReviewsSql, Integer.class);

                // 查询已完成的复习次数
                String completedReviewsSql = "SELECT COUNT(*) FROM review_items WHERE is_completed = TRUE";
                completedReviews = jdbcTemplate.queryForObject(completedReviewsSql, Integer.class);

                // 计算复习准确率
                if (totalReviews > 0) {
                    reviewAccuracy = (double) completedReviews / totalReviews * 100;
                }

                // 平均复习时间（模拟）
                averageReviewTime = 45;
            } catch (Exception e) {
                System.out.println("查询复习统计时发生错误: " + e.getMessage());
            }

            // 5. 构建指标数据
            UserMetrics userMetrics = new UserMetrics(
                    totalUsers,
                    activeUsers,
                    newUsers,
                    5.2  // 模拟增长率
            );

            DocumentMetrics documentMetrics = new DocumentMetrics(
                    totalDocuments,
                    uploadedDocuments,
                    processedDocuments,
                    failedDocuments
            );

            VocabularyMetrics vocabularyMetrics = new VocabularyMetrics(
                    totalVocabulary,
                    addedVocabulary,
                    reviewedVocabulary,
                    masteredVocabulary
            );

            ReviewMetrics reviewMetrics = new ReviewMetrics(
                    totalReviews,
                    completedReviews,
                    reviewAccuracy,
                    averageReviewTime
            );

            MetricsInfo metricsInfo = new MetricsInfo(
                    userMetrics,
                    documentMetrics,
                    vocabularyMetrics,
                    reviewMetrics
            );

            // 6. 构建趋势数据
            Map<String, List<Integer>> trends = new HashMap<>();

            // 用户趋势（模拟）
            List<Integer> userTrend = new ArrayList<>();
            userTrend.add(totalUsers - 500);
            userTrend.add(totalUsers - 300);
            userTrend.add(totalUsers - 100);
            userTrend.add(totalUsers);
            trends.put("users", userTrend);

            // 文档趋势（模拟）
            List<Integer> documentTrend = new ArrayList<>();
            documentTrend.add(totalDocuments - 500);
            documentTrend.add(totalDocuments - 300);
            documentTrend.add(totalDocuments - 100);
            documentTrend.add(totalDocuments);
            trends.put("documents", documentTrend);

            // 词汇趋势（模拟）
            List<Integer> vocabularyTrend = new ArrayList<>();
            vocabularyTrend.add(totalVocabulary - 5000);
            vocabularyTrend.add(totalVocabulary - 3000);
            vocabularyTrend.add(totalVocabulary - 1000);
            vocabularyTrend.add(totalVocabulary);
            trends.put("vocabulary", vocabularyTrend);

            // 7. 构建响应数据
            StatisticsData statisticsData = new StatisticsData(
                    request.getPeriod(),
                    metricsInfo,
                    trends
            );

            StatisticsResponse response = new StatisticsResponse(true, "获取系统统计信息成功", statisticsData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取系统统计信息过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new StatisticsResponse(false, "获取系统统计信息失败: " + e.getMessage(), null)
            );
        }
    }
}
--- 结束文件: SystemGetStatistics.java ---

--- 开始文件: SystemGetStatus.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.Duration;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetStatus {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 系统启动时间
    private static final LocalDateTime SYSTEM_START_TIME = LocalDateTime.now();

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取系统状态请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 响应DTO
    public static class StatusResponse {
        private boolean success;
        private String message;
        private StatusData data;

        public StatusResponse(boolean success, String message, StatusData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public StatusData getData() { return data; }
        public void setData(StatusData data) { this.data = data; }
    }

    public static class StatusData {
        private String status;
        private String uptime;
        private String version;
        private String environment;
        private DatabaseInfo database;
        private CacheInfo cache;
        private ApiInfo api;

        public StatusData(String status, String uptime, String version, String environment,
                          DatabaseInfo database, CacheInfo cache, ApiInfo api) {
            this.status = status;
            this.uptime = uptime;
            this.version = version;
            this.environment = environment;
            this.database = database;
            this.cache = cache;
            this.api = api;
        }

        public String getStatus() { return status; }
        public void setStatus(String status) { this.status = status; }

        public String getUptime() { return uptime; }
        public void setUptime(String uptime) { this.uptime = uptime; }

        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }

        public String getEnvironment() { return environment; }
        public void setEnvironment(String environment) { this.environment = environment; }

        public DatabaseInfo getDatabase() { return database; }
        public void setDatabase(DatabaseInfo database) { this.database = database; }

        public CacheInfo getCache() { return cache; }
        public void setCache(CacheInfo cache) { this.cache = cache; }

        public ApiInfo getApi() { return api; }
        public void setApi(ApiInfo api) { this.api = api; }
    }

    public static class DatabaseInfo {
        private String status;
        private String version;

        public DatabaseInfo(String status, String version) {
            this.status = status;
            this.version = version;
        }

        public String getStatus() { return status; }
        public void setStatus(String status) { this.status = status; }

        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }
    }

    public static class CacheInfo {
        private String status;
        private double hitRate;

        public CacheInfo(String status, double hitRate) {
            this.status = status;
            this.hitRate = hitRate;
        }

        public String getStatus() { return status; }
        public void setStatus(String status) { this.status = status; }

        public double getHitRate() { return hitRate; }
        public void setHitRate(double hitRate) { this.hitRate = hitRate; }
    }

    public static class ApiInfo {
        private String status;
        private String responseTime;
        private int requestsPerMinute;

        public ApiInfo(String status, String responseTime, int requestsPerMinute) {
            this.status = status;
            this.responseTime = responseTime;
            this.requestsPerMinute = requestsPerMinute;
        }

        public String getStatus() { return status; }
        public void setStatus(String status) { this.status = status; }

        public String getResponseTime() { return responseTime; }
        public void setResponseTime(String responseTime) { this.responseTime = responseTime; }

        public int getRequestsPerMinute() { return requestsPerMinute; }
        public void setRequestsPerMinute(int requestsPerMinute) { this.requestsPerMinute = requestsPerMinute; }
    }

    @GetMapping("/status")
    public ResponseEntity<StatusResponse> getStatus() {
        // 打印接收到的请求
        printRequest("GET /api/system/status");

        try {
            // 1. 计算系统运行时间
            Duration uptimeDuration = Duration.between(SYSTEM_START_TIME, LocalDateTime.now());
            long days = uptimeDuration.toDays();
            long hours = uptimeDuration.toHours() % 24;
            long minutes = uptimeDuration.toMinutes() % 60;
            String uptime = days + "d " + hours + "h " + minutes + "m";

            // 2. 获取最新版本信息
            String versionSql = "SELECT version_number FROM app_versions ORDER BY release_date DESC LIMIT 1";
            List<Map<String, Object>> versions = jdbcTemplate.queryForList(versionSql);
            printQueryResult("版本查询结果: " + versions);

            String version = "1.0.0";
            if (!versions.isEmpty()) {
                version = (String) versions.get(0).get("version_number");
            }

            // 3. 测试数据库连接
            boolean dbConnected = false;
            String dbVersion = "unknown";
            try {
                String testSql = "SELECT 1";
                jdbcTemplate.queryForObject(testSql, Integer.class);
                dbConnected = true;

                // 尝试获取数据库版本（MySQL语法）
                try {
                    List<Map<String, Object>> dbInfo = jdbcTemplate.queryForList("SELECT VERSION() as version");
                    if (!dbInfo.isEmpty()) {
                        dbVersion = (String) dbInfo.get(0).get("version");
                    }
                } catch (Exception e) {
                    // 如果获取版本失败，使用默认值
                    dbVersion = "5.7.0";
                }
            } catch (Exception e) {
                dbConnected = false;
            }

            // 4. 构建响应数据
            DatabaseInfo dbInfo = new DatabaseInfo(
                    dbConnected ? "connected" : "disconnected",
                    dbVersion
            );

            CacheInfo cacheInfo = new CacheInfo(
                    "healthy",
                    0.85
            );

            ApiInfo apiInfo = new ApiInfo(
                    "healthy",
                    "120ms",
                    150
            );

            StatusData statusData = new StatusData(
                    "healthy",
                    uptime,
                    version,
                    "development", // 课设环境
                    dbInfo,
                    cacheInfo,
                    apiInfo
            );

            StatusResponse response = new StatusResponse(true, "获取系统状态成功", statusData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取系统状态过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            // 返回错误状态
            DatabaseInfo errorDbInfo = new DatabaseInfo("error", "unknown");
            CacheInfo errorCacheInfo = new CacheInfo("error", 0.0);
            ApiInfo errorApiInfo = new ApiInfo("error", "0ms", 0);

            StatusData errorData = new StatusData(
                    "error",
                    "0d 0h 0m",
                    "1.0.0",
                    "development",
                    errorDbInfo,
                    errorCacheInfo,
                    errorApiInfo
            );

            StatusResponse errorResponse = new StatusResponse(false, "获取系统状态失败: " + e.getMessage(), errorData);
            printResponse(errorResponse);

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }
}

--- 结束文件: SystemGetStatus.java ---

--- 开始文件: SystemGetTermsOfService.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetTermsOfService {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取使用条款请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("=========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class TermsRequest {
        private String language;
        private String version;

        public String getLanguage() { return language != null ? language : "zh-CN"; }
        public void setLanguage(String language) { this.language = language; }

        public String getVersion() { return version != null ? version : "1.0"; }
        public void setVersion(String version) { this.version = version; }
    }

    // 响应DTO
    public static class TermsResponse {
        private boolean success;
        private String message;
        private TermsData data;

        public TermsResponse(boolean success, String message, TermsData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public TermsData getData() { return data; }
        public void setData(TermsData data) { this.data = data; }
    }

    public static class TermsData {
        private String title;
        private String version;
        private String language;
        private TermsContent content;

        public TermsData(String title, String version, String language, TermsContent content) {
            this.title = title;
            this.version = version;
            this.language = language;
            this.content = content;
        }

        public String getTitle() { return title; }
        public void setTitle(String title) { this.title = title; }

        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }

        public String getLanguage() { return language; }
        public void setLanguage(String language) { this.language = language; }

        public TermsContent getContent() { return content; }
        public void setContent(TermsContent content) { this.content = content; }
    }

    public static class TermsContent {
        private String preamble;
        private List<TermsSection> terms;
        private String lastUpdated;

        public TermsContent(String preamble, List<TermsSection> terms, String lastUpdated) {
            this.preamble = preamble;
            this.terms = terms;
            this.lastUpdated = lastUpdated;
        }

        public String getPreamble() { return preamble; }
        public void setPreamble(String preamble) { this.preamble = preamble; }

        public List<TermsSection> getTerms() { return terms; }
        public void setTerms(List<TermsSection> terms) { this.terms = terms; }

        public String getLastUpdated() { return lastUpdated; }
        public void setLastUpdated(String lastUpdated) { this.lastUpdated = lastUpdated; }
    }

    public static class TermsSection {
        private String section;
        private String content;

        public TermsSection(String section, String content) {
            this.section = section;
            this.content = content;
        }

        public String getSection() { return section; }
        public void setSection(String section) { this.section = section; }

        public String getContent() { return content; }
        public void setContent(String content) { this.content = content; }
    }

    @GetMapping("/terms")
    public ResponseEntity<TermsResponse> getTermsOfService(@RequestParam(required = false) String language,
                                                           @RequestParam(required = false) String version) {

        // 创建请求对象
        TermsRequest request = new TermsRequest();
        request.setLanguage(language);
        request.setVersion(version);

        // 打印接收到的请求
        printRequest(request);

        try {
            // 1. 根据语言和版本构建使用条款
            TermsContent termsContent = buildTermsContent(request.getLanguage(), request.getVersion());

            // 2. 构建响应数据
            TermsData termsData = new TermsData(
                    "使用条款",
                    request.getVersion(),
                    request.getLanguage(),
                    termsContent
            );

            TermsResponse response = new TermsResponse(true, "获取使用条款成功", termsData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取使用条款过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new TermsResponse(false, "获取使用条款失败: " + e.getMessage(), null)
            );
        }
    }

    // 构建使用条款内容
    private TermsContent buildTermsContent(String language, String version) {
        String preamble;
        List<TermsSection> terms = new ArrayList<>();

        if ("zh-CN".equals(language)) {
            preamble = "欢迎使用Vue Reading App（以下简称\"本应用\"）。请仔细阅读以下使用条款。";

            terms.add(new TermsSection("1. 服务条款",
                    "1.1 本应用由Vue Reading App团队（以下简称\"我们\"）提供。" +
                            "1.2 用户在使用本应用前，应当仔细阅读本条款，并同意遵守本条款及相关法律法规。" +
                            "1.3 我们保留随时修改本条款的权利，修改后的条款将在本应用内公布，不另行通知。"));

            terms.add(new TermsSection("2. 用户责任",
                    "2.1 用户应保证其提供的信息真实、准确、完整。" +
                            "2.2 用户不得利用本应用从事任何违法活动或侵犯他人权益的行为。" +
                            "2.3 用户应妥善保管其账户信息，不得将其账户转让或出借给他人使用。" +
                            "2.4 用户对其账户下的所有行为承担全部责任。"));

            terms.add(new TermsSection("3. 知识产权",
                    "3.1 本应用的所有内容，包括但不限于文字、图片、音频、视频、软件等，均受知识产权法保护。" +
                            "3.2 未经我们书面许可，用户不得以任何形式复制、传播、修改或商业使用本应用的内容。" +
                            "3.3 用户上传的内容，其知识产权仍归用户所有，但用户授予我们使用、存储、展示该内容的权利。"));

            terms.add(new TermsSection("4. 隐私保护",
                    "4.1 我们尊重用户隐私，将按照隐私政策保护用户的个人信息。" +
                            "4.2 我们不会在未经用户同意的情况下向第三方提供用户的个人信息，法律法规另有规定的除外。" +
                            "4.3 用户有权随时查看、修改或删除其个人信息。"));

            terms.add(new TermsSection("5. 服务变更与终止",
                    "5.1 我们有权根据业务需要调整服务内容，或暂停、终止部分或全部服务。" +
                            "5.2 如用户违反本条款，我们有权暂停或终止为用户提供服务。" +
                            "5.3 服务终止后，用户使用本应用的权利立即终止，我们不再对用户承担任何义务。"));

            terms.add(new TermsSection("6. 免责声明",
                    "6.1 本应用按\"现状\"提供，我们不保证服务不会中断，也不保证服务的及时性、安全性、准确性。" +
                            "6.2 对于因使用本应用而导致的任何直接或间接损失，我们不承担任何责任。" +
                            "6.3 用户理解并同意，其使用本应用的风险由其自行承担。"));

            terms.add(new TermsSection("7. 法律适用与争议解决",
                    "7.1 本条款的订立、执行和解释及争议的解决均适用中华人民共和国法律。" +
                            "7.2 如双方就本条款内容或其执行发生任何争议，应首先友好协商解决；协商不成时，任何一方均可向我们所在地的人民法院提起诉讼。"));

            terms.add(new TermsSection("8. 其他",
                    "8.1 本条款构成用户与我们之间就本应用使用所达成的完整协议。" +
                            "8.2 如本条款的任何条款被认定为无效或不可执行，该条款应在最小范围内受影响，不影响其他条款的效力。" +
                            "8.3 我们的未行使或延迟行使其在本条款项下的权利，不构成对该权利的放弃。"));

        } else {
            // 默认英文版本
            preamble = "Welcome to Vue Reading App (hereinafter referred to as \"the App\"). Please read the following terms of service carefully.";

            terms.add(new TermsSection("1. Service Terms",
                    "1.1 The App is provided by the Vue Reading App team (hereinafter referred to as \"we\" or \"us\")." +
                            "1.2 Before using the App, users should carefully read these terms and agree to comply with these terms and relevant laws and regulations." +
                            "1.3 We reserve the right to modify these terms at any time. Modified terms will be published in the App without further notice."));

            terms.add(new TermsSection("2. User Responsibilities",
                    "2.1 Users shall ensure that the information they provide is true, accurate, and complete." +
                            "2.2 Users shall not use the App to engage in any illegal activities or infringe upon the rights of others." +
                            "2.3 Users shall properly keep their account information and shall not transfer or lend their accounts to others." +
                            "2.4 Users shall bear full responsibility for all actions under their accounts."));

            terms.add(new TermsSection("3. Intellectual Property",
                    "3.1 All content of the App, including but not limited to text, images, audio, video, software, etc., is protected by intellectual property laws." +
                            "3.2 Without our written permission, users shall not copy, disseminate, modify, or commercially use the content of the App in any form." +
                            "3.3 The intellectual property rights of content uploaded by users remain with the users, but users grant us the right to use, store, and display such content."));

            terms.add(new TermsSection("4. Privacy Protection",
                    "4.1 We respect user privacy and will protect users' personal information in accordance with the privacy policy." +
                            "4.2 We will not provide users' personal information to third parties without user consent, except as required by laws and regulations." +
                            "4.3 Users have the right to view, modify, or delete their personal information at any time."));

            terms.add(new TermsSection("5. Service Changes and Termination",
                    "5.1 We have the right to adjust service content, or suspend or terminate part or all of the services according to business needs." +
                            "5.2 If users violate these terms, we have the right to suspend or terminate the provision of services to users." +
                            "5.3 After service termination, users' right to use the App immediately terminates, and we no longer have any obligations to users."));

            terms.add(new TermsSection("6. Disclaimer",
                    "6.1 The App is provided \"as is\". We do not guarantee that the service will not be interrupted, nor do we guarantee the timeliness, security, or accuracy of the service." +
                            "6.2 We shall not be liable for any direct or indirect losses caused by using the App." +
                            "6.3 Users understand and agree that the risks of using the App are borne by themselves."));

            terms.add(new TermsSection("7. Governing Law and Dispute Resolution",
                    "7.1 The conclusion, execution, and interpretation of these terms and the resolution of disputes shall be governed by the laws of the People's Republic of China." +
                            "7.2 If any dispute arises between the parties regarding the content or execution of these terms, the parties shall first try to resolve it through friendly negotiation; if negotiation fails, either party may file a lawsuit with the people's court in our location."));

            terms.add(new TermsSection("8. Miscellaneous",
                    "8.1 These terms constitute the complete agreement between users and us regarding the use of the App." +
                            "8.2 If any provision of these terms is deemed invalid or unenforceable, that provision shall be affected to the minimum extent and shall not affect the validity of other provisions." +
                            "8.3 Our failure or delay in exercising our rights under these terms shall not constitute a waiver of such rights."));
        }

        return new TermsContent(
                preamble,
                terms,
                LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME)
        );
    }
}


--- 结束文件: SystemGetTermsOfService.java ---

--- 开始文件: SystemGetVersion.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;

@RestController
@RequestMapping("/api/v1/system")
public class SystemGetVersion {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到获取系统版本请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 响应DTO
    public static class VersionResponse {
        private boolean success;
        private String message;
        private VersionData data;

        public VersionResponse(boolean success, String message, VersionData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public VersionData getData() { return data; }
        public void setData(VersionData data) { this.data = data; }
    }

    public static class VersionData {
        private String version;
        private String buildNumber;
        private String commitHash;
        private String releaseDate;
        private String latestVersion;
        private boolean updateAvailable;
        private String updateUrl;
        private String changelogUrl;
        private String supportPeriod;

        public VersionData(String version, String buildNumber, String commitHash, String releaseDate,
                           String latestVersion, boolean updateAvailable, String updateUrl,
                           String changelogUrl, String supportPeriod) {
            this.version = version;
            this.buildNumber = buildNumber;
            this.commitHash = commitHash;
            this.releaseDate = releaseDate;
            this.latestVersion = latestVersion;
            this.updateAvailable = updateAvailable;
            this.updateUrl = updateUrl;
            this.changelogUrl = changelogUrl;
            this.supportPeriod = supportPeriod;
        }

        public String getVersion() { return version; }
        public void setVersion(String version) { this.version = version; }

        public String getBuildNumber() { return buildNumber; }
        public void setBuildNumber(String buildNumber) { this.buildNumber = buildNumber; }

        public String getCommitHash() { return commitHash; }
        public void setCommitHash(String commitHash) { this.commitHash = commitHash; }

        public String getReleaseDate() { return releaseDate; }
        public void setReleaseDate(String releaseDate) { this.releaseDate = releaseDate; }

        public String getLatestVersion() { return latestVersion; }
        public void setLatestVersion(String latestVersion) { this.latestVersion = latestVersion; }

        public boolean isUpdateAvailable() { return updateAvailable; }
        public void setUpdateAvailable(boolean updateAvailable) { this.updateAvailable = updateAvailable; }

        public String getUpdateUrl() { return updateUrl; }
        public void setUpdateUrl(String updateUrl) { this.updateUrl = updateUrl; }

        public String getChangelogUrl() { return changelogUrl; }
        public void setChangelogUrl(String changelogUrl) { this.changelogUrl = changelogUrl; }

        public String getSupportPeriod() { return supportPeriod; }
        public void setSupportPeriod(String supportPeriod) { this.supportPeriod = supportPeriod; }
    }

    @GetMapping("/version")
    public ResponseEntity<VersionResponse> getVersion() {
        // 打印接收到的请求
        printRequest("GET /api/system/version");

        try {
            // 1. 查询最新的版本信息
            String sql = "SELECT version_number, release_date, release_notes, is_forced_update, created_at FROM app_versions ORDER BY release_date DESC LIMIT 1";

            List<Map<String, Object>> versions = jdbcTemplate.queryForList(sql);
            printQueryResult(versions);

            if (versions.isEmpty()) {
                // 如果没有版本信息，返回默认值
                VersionData defaultData = new VersionData(
                        "1.0.0",
                        "20240101-001",
                        "abc123def456",
                        LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME),
                        "1.0.0",
                        false,
                        "/download",
                        "/changelog",
                        "12个月"
                );

                VersionResponse response = new VersionResponse(true, "获取版本信息成功（使用默认值）", defaultData);
                printResponse(response);
                return ResponseEntity.ok(response);
            }

            Map<String, Object> version = versions.get(0);

            // 2. 构建响应数据
            String versionNumber = (String) version.get("version_number");
            LocalDateTime releaseDate = (LocalDateTime) version.get("release_date");
            String releaseNotes = (String) version.get("release_notes");
            Boolean isForcedUpdate = (Boolean) version.get("is_forced_update");

            // 生成构建号（基于发布日期）
            String buildNumber = releaseDate.format(DateTimeFormatter.ofPattern("yyyyMMdd")) + "-001";

            // 生成提交哈希（模拟）
            String commitHash = "commit_" + versionNumber.replace(".", "") + "_" + releaseDate.getDayOfMonth();

            // 判断是否有更新（这里简单处理，总是返回false）
            boolean updateAvailable = false;

            VersionData versionData = new VersionData(
                    versionNumber,
                    buildNumber,
                    commitHash,
                    releaseDate.format(DateTimeFormatter.ISO_DATE_TIME),
                    versionNumber, // 假设当前就是最新版本
                    updateAvailable,
                    "/download",
                    "/changelog",
                    "12个月"
            );

            VersionResponse response = new VersionResponse(true, "获取版本信息成功", versionData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("获取版本信息过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            // 发生错误时返回默认版本信息
            VersionData errorData = new VersionData(
                    "1.0.0",
                    "error-001",
                    "error-hash",
                    LocalDateTime.now().format(DateTimeFormatter.ISO_DATE_TIME),
                    "1.0.0",
                    false,
                    "/download",
                    "/changelog",
                    "12个月"
            );

            VersionResponse errorResponse = new VersionResponse(false, "获取版本信息失败: " + e.getMessage(), errorData);
            printResponse(errorResponse);

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }
}

--- 结束文件: SystemGetVersion.java ---

--- 开始文件: SystemMarkAnnouncementAsRead.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.util.Map;
import java.util.HashMap;

@RestController
@RequestMapping("/api/v1/system")
public class SystemMarkAnnouncementAsRead {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到标记公告为已读请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("===========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class MarkAsReadRequest {
        private String announcementId;

        public String getAnnouncementId() { return announcementId; }
        public void setAnnouncementId(String announcementId) { this.announcementId = announcementId; }
    }

    // 响应DTO
    public static class MarkAsReadResponse {
        private boolean success;
        private String message;

        public MarkAsReadResponse(boolean success, String message) {
            this.success = success;
            this.message = message;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }
    }

    @PutMapping("/announcements/{announcementId}/read")
    public ResponseEntity<MarkAsReadResponse> markAnnouncementAsRead(
            @PathVariable String announcementId,
            @RequestBody(required = false) MarkAsReadRequest requestBody) {

        // 处理请求数据
        String actualAnnouncementId = announcementId;
        if (requestBody != null && requestBody.getAnnouncementId() != null) {
            actualAnnouncementId = requestBody.getAnnouncementId();
        }

        // 创建请求对象
        Map<String, Object> requestInfo = new HashMap<>();
        requestInfo.put("announcementId", actualAnnouncementId);
        requestInfo.put("pathVariable", announcementId);
        requestInfo.put("requestBody", requestBody);

        // 打印接收到的请求
        printRequest(requestInfo);

        try {
            // 1. 验证公告ID
            if (actualAnnouncementId == null || actualAnnouncementId.trim().isEmpty()) {
                return ResponseEntity.badRequest().body(
                        new MarkAsReadResponse(false, "公告ID不能为空")
                );
            }

            // 2. 从公告ID中提取通知ID
            // 假设公告ID格式为 "ann_123" 或直接是数字
            String notificationIdStr = actualAnnouncementId;
            if (actualAnnouncementId.startsWith("ann_")) {
                notificationIdStr = actualAnnouncementId.substring(4);
            }

            int notificationId;
            try {
                notificationId = Integer.parseInt(notificationIdStr);
            } catch (NumberFormatException e) {
                return ResponseEntity.badRequest().body(
                        new MarkAsReadResponse(false, "无效的公告ID格式")
                );
            }

            // 3. 检查公告是否存在
            String checkSql = "SELECT notification_id FROM notifications WHERE notification_id = ? AND type = 'announcement'";
            Integer existingId = jdbcTemplate.queryForObject(checkSql, Integer.class, notificationId);

            if (existingId == null) {
                return ResponseEntity.status(HttpStatus.NOT_FOUND).body(
                        new MarkAsReadResponse(false, "未找到指定的公告")
                );
            }

            // 4. 更新公告为已读状态
            LocalDateTime now = LocalDateTime.now();
            String updateSql = "UPDATE notifications SET is_read = TRUE, updated_at = ? WHERE notification_id = ?";

            int rowsUpdated = jdbcTemplate.update(updateSql, now, notificationId);
            printQueryResult("更新了 " + rowsUpdated + " 条记录，公告ID: " + notificationId);

            if (rowsUpdated > 0) {
                MarkAsReadResponse response = new MarkAsReadResponse(true, "公告已标记为已读");
                printResponse(response);
                return ResponseEntity.ok(response);
            } else {
                return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                        new MarkAsReadResponse(false, "更新公告状态失败")
                );
            }

        } catch (Exception e) {
            System.err.println("标记公告为已读过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new MarkAsReadResponse(false, "标记公告为已读失败: " + e.getMessage())
            );
        }
    }
}

--- 结束文件: SystemMarkAnnouncementAsRead.java ---

--- 开始文件: SystemSubmitBugReport.java ---
package com.vue.readingapp.system;

import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;
import java.util.UUID;

@RestController
@RequestMapping("/api/v1/system")
public class SystemSubmitBugReport {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // 打印接收到的请求
    private void printRequest(Object request) {
        System.out.println("=== 收到提交错误报告请求 ===");
        System.out.println("请求数据: " + request);
        System.out.println("请求时间: " + LocalDateTime.now());
        System.out.println("=========================");
    }

    // 打印查询结果
    private void printQueryResult(Object result) {
        System.out.println("=== 数据库查询结果 ===");
        System.out.println("查询结果: " + result);
        System.out.println("===================");
    }

    // 打印返回数据
    private void printResponse(Object response) {
        System.out.println("=== 准备返回的响应 ===");
        System.out.println("响应数据: " + response);
        System.out.println("===================");
    }

    // 请求DTO
    public static class BugReportRequest {
        private String title;
        private String description;
        private List<String> steps;
        private String expected;
        private String actual;
        private EnvironmentInfo environment;
        private String screenshot;
        private String priority;
        private String category;
        private List<String> tags;

        public String getTitle() { return title; }
        public void setTitle(String title) { this.title = title; }

        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }

        public List<String> getSteps() { return steps != null ? steps : new ArrayList<>(); }
        public void setSteps(List<String> steps) { this.steps = steps; }

        public String getExpected() { return expected; }
        public void setExpected(String expected) { this.expected = expected; }

        public String getActual() { return actual; }
        public void setActual(String actual) { this.actual = actual; }

        public EnvironmentInfo getEnvironment() { return environment != null ? environment : new EnvironmentInfo(); }
        public void setEnvironment(EnvironmentInfo environment) { this.environment = environment; }

        public String getScreenshot() { return screenshot; }
        public void setScreenshot(String screenshot) { this.screenshot = screenshot; }

        public String getPriority() { return priority != null ? priority : "medium"; }
        public void setPriority(String priority) { this.priority = priority; }

        public String getCategory() { return category != null ? category : "general"; }
        public void setCategory(String category) { this.category = category; }

        public List<String> getTags() { return tags != null ? tags : new ArrayList<>(); }
        public void setTags(List<String> tags) { this.tags = tags; }
    }

    public static class EnvironmentInfo {
        private String browser;
        private String os;
        private String device;

        public String getBrowser() { return browser != null ? browser : "unknown"; }
        public void setBrowser(String browser) { this.browser = browser; }

        public String getOs() { return os != null ? os : "unknown"; }
        public void setOs(String os) { this.os = os; }

        public String getDevice() { return device != null ? device : "unknown"; }
        public void setDevice(String device) { this.device = device; }
    }

    // 响应DTO
    public static class BugReportResponse {
        private boolean success;
        private String message;
        private BugReportData data;

        public BugReportResponse(boolean success, String message, BugReportData data) {
            this.success = success;
            this.message = message;
            this.data = data;
        }

        public boolean isSuccess() { return success; }
        public void setSuccess(boolean success) { this.success = success; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public BugReportData getData() { return data; }
        public void setData(BugReportData data) { this.data = data; }
    }

    public static class BugReportData {
        private String ticketId;
        private String message;
        private String estimatedResolutionTime;
        private List<String> nextSteps;

        public BugReportData(String ticketId, String message, String estimatedResolutionTime, List<String> nextSteps) {
            this.ticketId = ticketId;
            this.message = message;
            this.estimatedResolutionTime = estimatedResolutionTime;
            this.nextSteps = nextSteps;
        }

        public String getTicketId() { return ticketId; }
        public void setTicketId(String ticketId) { this.ticketId = ticketId; }

        public String getMessage() { return message; }
        public void setMessage(String message) { this.message = message; }

        public String getEstimatedResolutionTime() { return estimatedResolutionTime; }
        public void setEstimatedResolutionTime(String estimatedResolutionTime) { this.estimatedResolutionTime = estimatedResolutionTime; }

        public List<String> getNextSteps() { return nextSteps; }
        public void setNextSteps(List<String> nextSteps) { this.nextSteps = nextSteps; }
    }

    @PostMapping("/bug-report")
    public ResponseEntity<BugReportResponse> submitBugReport(@RequestBody BugReportRequest request) {
        // 打印接收到的请求
        printRequest(request);

        try {
            // 1. 验证请求数据
            if (request.getTitle() == null || request.getTitle().trim().isEmpty()) {
                return ResponseEntity.badRequest().body(
                        new BugReportResponse(false, "错误报告标题不能为空", null)
                );
            }

            if (request.getDescription() == null || request.getDescription().trim().isEmpty()) {
                return ResponseEntity.badRequest().body(
                        new BugReportResponse(false, "错误报告描述不能为空", null)
                );
            }

            // 2. 生成错误报告ID
            String ticketId = "BUG-" + LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyyMMdd")) +
                    "-" + UUID.randomUUID().toString().substring(0, 8).toUpperCase();

            // 3. 获取当前用户ID（如果有）
            Integer userId = null;
            // 注意：这里需要从请求头或会话中获取用户ID，但根据课设要求，我们简化处理

            // 4. 准备插入数据
            LocalDateTime now = LocalDateTime.now();

            // 将步骤列表转换为字符串
            String stepsStr = String.join("|||", request.getSteps());

            // 将环境信息转换为字符串
            String envStr = request.getEnvironment().getBrowser() + "|||" +
                    request.getEnvironment().getOs() + "|||" +
                    request.getEnvironment().getDevice();

            // 将标签列表转换为字符串
            String tagsStr = String.join(",", request.getTags());

            // 5. 插入到feedback_messages表
            String insertSql = "INSERT INTO feedback_messages (user_id, title, description, steps, expected_result, actual_result, " +
                    "environment_info, screenshot_data, priority, category, tags, status, created_at, updated_at) " +
                    "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";

            int affectedRows = jdbcTemplate.update(insertSql,
                    userId,
                    request.getTitle(),
                    request.getDescription(),
                    stepsStr,
                    request.getExpected(),
                    request.getActual(),
                    envStr,
                    request.getScreenshot(),
                    request.getPriority(),
                    request.getCategory(),
                    tagsStr,
                    "pending", // 初始状态
                    now,
                    now
            );

            printQueryResult("插入错误报告，影响行数: " + affectedRows);

            // 6. 构建响应数据
            List<String> nextSteps = new ArrayList<>();
            nextSteps.add("我们会通过邮件通知您处理进度");
            nextSteps.add("如有更多信息需要补充，我们会联系您");
            nextSteps.add("您可以通过工单ID查询处理状态");

            BugReportData reportData = new BugReportData(
                    ticketId,
                    "错误报告已提交，我们会尽快处理",
                    "2-3个工作日",
                    nextSteps
            );

            BugReportResponse response = new BugReportResponse(true, "错误报告提交成功", reportData);

            // 打印返回数据
            printResponse(response);

            return ResponseEntity.ok(response);

        } catch (Exception e) {
            System.err.println("提交错误报告过程中发生错误: " + e.getMessage());
            e.printStackTrace();

            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(
                    new BugReportResponse(false, "提交错误报告失败: " + e.getMessage(), null)
            );
        }
    }
}
--- 结束文件: SystemSubmitBugReport.java ---

