# 用户管理 API 文档

**版本:** 1.0.0
**最后更新:** 2025-12-17

本文档详细描述了用户管理模块的 API 接口，包括用户认证、密码管理、邮箱验证、个人信息管理和订阅管理。

---

## 认证 (Authentication)

### 1. 用户注册

**接口名称**: 用户注册
**功能描述**: 创建一个新的用户账户。
**请求**:
*   **方法**: `POST`
*   **路径**: `/api/v1/auth/register`
*   **请求头**: `Content-Type: application/json`
**请求参数**:
| 参数名 | 位置 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| `username` | `body` | `string` | 是 | 用户名 (唯一) |
| `email` | `body` | `string` | 是 | 电子邮箱 (唯一) |
| `password` | `body` | `string` | 是 | 密码 (最小长度6位) |
| `nickname` | `body` | `string` | 否 | 昵称 (默认为用户名) |
**成功响应**:
*   **状态码**: `201 Created`
*   **响应体**: `{"success": true, "message": "注册成功", "data": {"user": {"id": 2, "username": "newuser"}}}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 400 | 4001 | 请求参数无效 (如邮箱格式错误) |
| 400 | 4002 | 邮箱或用户名已被注册 |
| 500 | 1003 | 服务器内部错误 |


---

### 2. 用户登录

**接口名称**: 用户登录
**功能描述**: 使用邮箱和密码进行认证，返回 `accessToken` 和 `refreshToken`。
**请求**:
*   **方法**: `POST`
*   **路径**: `/api/v1/auth/login`
**请求参数**:
| 参数名 | 位置 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| `email` | `body` | `string` | 是 | 用户的电子邮箱 |
| `password` | `body` | `string` | 是 | 用户的密码 |
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "登录成功", "data": {"accessToken": "...", "refreshToken": "...", "expiresIn": 3600}}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
。

| :--- | :--- | :--- |
| 401 | 4101 | 邮箱或密码错误 |
| 500 | 1003 | 服务器内部错误 |

---

### 3. 用户登出

**接口名称**: 用户登出
**功能描述**: 清除用户会话，使 `accessToken` 失效。
**请求**:
*   **方法**: `POST`
*   **路径**: `/api/v1/auth/logout`
*   **请求头**: `Authorization: Bearer <JWT>`
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "登出成功"}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 401 | 1001 | 未授权或 Token 失效 |
| 500 | 1003 | 服务器内部错误 |

---

### 4. 刷新令牌

**接口名称**: 刷新令牌
**功能描述**: 使用 `refreshToken` 获取新的 `accessToken`。
**请求**:
*   **方法**: `POST`
*   **路径**: `/api/v1/auth/refresh-token`
**请求参数**:
| 参数名 | 位置 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| `refresh_token` | `body` | `string` | 是 | 用户的刷新令牌 |
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "令牌刷新成功", "data": {"access_token": "...", "refresh_token": "...", "expires_in": 3600}}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 401 | 4102 | 刷新令牌无效或已过期 |
| 500 | 1003 | 服务器内部错误 |

---

### 5. 获取当前用户信息

**接口名称**: 获取当前用户信息
**功能描述**: 获取当前已登录用户的详细信息。
**请求**:
*   **方法**: `GET`
*   **路径**: `/api/v1/auth/me`
*   **请求头**: `Authorization: Bearer <JWT>`
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "获取用户信息成功", "data": {"currentUser": {"id": 1, "username": "someuser", ...}}}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 401 | 1001 | 未授权或 Token 失效 |
| 404 | 1002 | 用户不存在 |
| 500 | 1003 | 服务器内部错误 |

---

## 密码管理 (Password Management)

### 6. 忘记密码

**接口名称**: 忘记密码
**功能描述**: 请求发送密码重置链接到指定邮箱。
**请求**:
*   **方法**: `POST`
*   **路径**: `/api/v1/auth/forgot-password`
**请求参数**:
| 参数名 | 位置 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| `email` | `body` | `string` | 是 | 用户注册的邮箱 |
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "如果邮箱存在，重置链接已发送"}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 400 | 4001 | 邮箱格式不正确 |
| 500 | 1003 | 服务器内部错误 |

---

### 7. 重置密码

**接口名称**: 重置密码
**功能描述**: 使用重置令牌为用户设置新密码。
**请求**:
*   **方法**: `POST`
*   **路径**: `/api/v1/auth/reset-password`
**请求参数**:
| 参数名 | 位置 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| `token` | `body` | `string` | 是 | 密码重置令牌 |
| `email` | `body` | `string` | 是 | 用户的电子邮箱 |
| `password` | `body` | `string` | 是 | 新密码 |
| `password_confirmation` | `body` | `string` | 是 | 确认新密码 |
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "密码重置成功，请使用新密码登录"}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 400 | 4104 | 重置令牌无效或已过期 |
| 400 | 4103 | 两次输入的密码不一致 |

---

### 8. 更新密码

**接口名称**: 更新密码
**功能描述**: 已登录用户更新自己的密码。
**请求**:
*   **方法**: `PUT`
*   **路径**: `/api/v1/auth/password`
*   **请求头**: `Authorization: Bearer <JWT>`
**请求参数**:
| 参数名 | 位置 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| `current_password` | `body` | `string` | 是 | 当前密码 |
| `new_password` | `body` | `string` | 是 | 新密码 |
| `new_password_confirmation` | `body` | `string` | 是 | 确认新密码 |
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "密码更新成功，请重新登录"}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 400 | 4105 | 当前密码错误 |
| 401 | 1001 | 未授权或 Token 失效 |

---

## 邮箱验证 (Email Verification)

### 9. 发送验证邮件

**接口名称**: 发送验证邮件
**功能描述**: 为当前登录用户发送一封邮箱验证邮件。
**请求**:
*   **方法**: `POST`
*   **路径**: `/api/v1/auth/send-verification-email`
*   **请求头**: `Authorization: Bearer <JWT>`
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "验证邮件已发送，请查收您的邮箱"}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 400 | 5001 | 邮箱已经验证过了 |
| 401 | 1001 | 未授权或 Token 失效 |

---

### 10. 验证邮箱

**接口名称**: 验证邮箱
**功能描述**: 使用令牌验证用户的邮箱地址。
**请求**:
*   **方法**: `POST`
*   **路径**: `/api/v1/auth/verify-email`
**请求参数**:
| 参数名 | 位置 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| `token` | `body` | `string` | 是 | 从邮件中获取的验证令牌 |
| `email` | `body` | `string` | 是 | 用户的电子邮箱 |
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "邮箱验证成功"}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 400 | 5002 | 验证令牌无效或邮箱不正确 |
| 400 | 5001 | 邮箱已经验证过了 |

---

## 用户资料 (User Profile)

### 11. 获取用户个人信息

**接口名称**: 获取用户个人信息
**功能描述**: 获取已登录用户的详细个人信息。
**请求**:
*   **方法**: `GET`
*   **路径**: `/api/v1/user/profile`
*   **请求头**: `Authorization: Bearer <JWT>`
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: (包含用户的详细信息，如 `id`, `username`, `email`, `preferences` 等)
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 401 | 1001 | 未授权或 Token 失效 |
| 404 | 1002 | 用户不存在 |

---

### 12. 更新用户个人信息

**接口名称**: 更新用户个人信息
**功能描述**: 更新已登录用户的个人信息。
**请求**:
*   **方法**: `PUT`
*   **路径**: `/api/v1/user/profile`
*   **请求头**: `Content-Type: application/json`, `Authorization: Bearer <JWT>`
**请求参数**:
| 参数名 | 位置 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| `nickname` | `body` | `string` | 否 | 新的昵称 |
| `bio` | `body` | `string` | 否 | 新的个人简介 |
| `location` | `body` | `string` | 否 | 新的所在地 |
| `website` | `body` | `string` | 否 | 新的个人网站 |
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "个人信息更新成功", "user": { ... }}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 400 | 2001 | 请求参数错误 |
| 401 | 1001 | 未授权或 Token 失效 |

---

## 订阅 (Subscription)

### 13. 获取用户订阅信息

**接口名称**: 获取用户订阅信息
**功能描述**: 获取用户的订阅计划、状态和功能。
**请求**:
*   **方法**: `GET`
*   **路径**: `/api/v1/user/subscription`
*   **请求头**: `Authorization: Bearer <JWT>`
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: (包含订阅的详细信息，如 `type`, `status`, `plan`, `features` 等)
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 401 | 1001 | 未授权或 Token 失效 |
| 404 | 1002 | 用户或订阅不存在 |

---

### 14. 更新用户订阅

**接口名称**: 更新用户订阅
**功能描述**: 更新用户的订阅计划。
**请求**:
*   **方法**: `PUT`
*   **路径**: `/api/v1/user/subscription`
*   **请求头**: `Content-Type: application/json`, `Authorization: Bearer <JWT>`
**请求参数**:
| 参数名 | 位置 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| `plan_id` | `body` | `string` | 是 | 新的计划ID (`free`, `premium_monthly`, `premium_yearly`) |
**成功响应**:
*   **状态码**: `200 OK`
*   **响应体**: `{"success": true, "message": "订阅计划更新成功", "subscription": { ... }}`
**错误响应**:
| HTTP 状态码 | 内部错误码 | 错误描述 |
| :--- | :--- | :--- |
| 400 | 3001 | 无效的计划ID |
| 401 | 1001 | 未授权或 Token 失效 |
